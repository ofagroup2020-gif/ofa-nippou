<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OFA 点呼システム | ログイン</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brandRow">
        <div class="logo"></div>
        <div>
          <div class="appTitle">OFA 点呼システム</div>
          <div class="appSub">出発点呼 / 帰着点呼・日報 / PDF・月報・CSV</div>
        </div>
        <div class="badge" id="statusBadge">未ログイン</div>
      </div>

      <div class="notice">
        <div class="noticeTitle">点呼の重要ルール（必読）</div>
        <ul>
          <li>点呼は <b>業務開始前（出発）</b> と <b>業務終了後（帰着）</b> の2回</li>
          <li>アルコールチェックは必須（<b>数値＋酒気判定</b>）</li>
          <li>免許証番号は必須（写真は任意）</li>
          <li>帰着点呼の日報はPDF提出されます</li>
        </ul>
      </div>

      <hr class="sep">

      <div class="titleSm">ログイン（パスワード）</div>
      <label>パスワード <span class="req">*</span></label>
      <input id="pw" type="password" placeholder="パスワードを入力" autocomplete="current-password" />

      <div class="btnrow">
        <button class="btn rainbow" id="btnDriver" type="button">ドライバーでログイン</button>
        <button class="btn dark" id="btnAdmin" type="button">管理者でログイン</button>
      </div>

      <small class="hint">
        パスワードは社内LINE/LINE公式で配布し、定期的に更新します。<br>
        LINE公式：<a href="https://lin.ee/8dsZjAo" target="_blank" rel="noopener">https://lin.ee/8dsZjAo</a>
      </small>

      <div class="toast" id="toast"></div>
    </div>
  </div>

  <script src="./config.js"></script>
  <script src="./common.js"></script>
  <script>
    (function(){
      const pw = document.getElementById('pw');
      const toast = document.getElementById('toast');
      const badge = document.getElementById('statusBadge');

      function setBadge(){
        const role = sessionStorage.getItem('ofa_role');
        badge.textContent = role ? (role === 'admin' ? '管理者ログイン中' : 'ログイン済') : '未ログイン';
      }
      setBadge();

      document.getElementById('btnDriver').addEventListener('click', () => {
        const v = (pw.value||'').trim();
        if(v !== OFA_DRIVER_PASSWORD){ showToast('パスワードが違います'); return; }
        sessionStorage.setItem('ofa_role','driver');
        sessionStorage.setItem('ofa_login_at', String(Date.now()));
        location.href = './home.html';
      });

      document.getElementById('btnAdmin').addEventListener('click', () => {
        const v = (pw.value||'').trim();
        if(v !== OFA_ADMIN_PASSWORD){ showToast('パスワードが違います'); return; }
        sessionStorage.setItem('ofa_role','admin');
        sessionStorage.setItem('ofa_login_at', String(Date.now()));
        location.href = './home.html';
      });

      function showToast(msg){
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(()=>toast.classList.remove('show'), 2400);
      }
    })();
  </script>
</body>
</html>
