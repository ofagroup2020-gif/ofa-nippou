<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>OFA 点呼 / 日報（ドライバー）</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="header">
    <div class="logo">OFA</div>
    <div class="titlewrap">
      <div class="title">点呼 / 日報（ドライバー）</div>
      <div class="subtitle">履歴保存（IndexedDB） / PDF・CSV出力 / 出発・帰着 分離</div>
    </div>
    <a href="./admin/index.html"><button class="rightTopBtn">管理</button></a>
  </div>

  <div class="container">

    <!-- 基本情報 -->
    <div class="card">
      <div class="h2">① 基本情報（必須）</div>
      <div class="note">
        ここは端末内（IndexedDB）に保存されます。<br />
        ※免許証写真は<strong>保存しません</strong>（PDF生成時のみ使用）。
      </div>

      <label>氏名（本名）*</label>
      <input id="p_name" placeholder="例：森下 洸" />

      <label>拠点（47都道府県 or 自由記入）*</label>
      <input id="p_base" placeholder="例：鹿児島県 / 東京都" />

      <label>車両番号（ナンバー）*</label>
      <input id="p_carNo" placeholder="例：鹿児島 580 あ 1234" />

      <label>運転免許証番号*</label>
      <input id="p_licenseNo" placeholder="例：第1234567890号" />

      <label>電話番号*</label>
      <input id="p_phone" inputmode="tel" placeholder="例：090-1234-5678" />

      <label>メールアドレス*</label>
      <input id="p_email" inputmode="email" placeholder="例：example@ofa.jp" />

      <label>運転免許証写真（PDFに埋め込み：任意）</label>
      <input id="f_licenseImg" type="file" accept="image/*" />
      <div class="small">※端末保存しません。PDF生成時のみ使用</div>

      <div class="actions" style="margin-top:12px">
        <button class="btn" id="btnSaveProfile">基本情報を保存</button>
        <button class="btn secondary" id="btnLoadProfile">読み込み</button>
      </div>

      <div class="divider"></div>

      <div class="note">
        <span class="chip"><span class="dot" id="dotProfile"></span> <span id="profileState">未保存</span></span>
      </div>
    </div>

    <!-- 出発点呼 -->
    <div class="card">
      <div class="h2">② 出発点呼（業務開始前）</div>
      <div class="note">
        出発時に<strong>出発の内容だけ</strong>入力します（帰着ODOはここでは入力しません）。
      </div>

      <label>点呼日時（手入力）*</label>
      <input id="d_at" type="datetime-local" />

      <label>点呼実施方法*</label>
      <select id="d_method">
        <option value="">選択</option>
        <option>対面</option>
        <option>電話</option>
        <option>アプリ</option>
        <option>その他</option>
      </select>

      <div class="row">
        <div>
          <label>睡眠時間（h）*</label>
          <input id="d_sleep" inputmode="decimal" placeholder="例：6.5" />
        </div>
        <div>
          <label>体温（℃）*</label>
          <input id="d_temp" inputmode="decimal" placeholder="例：36.5" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>体調*</label>
          <select id="d_condition">
            <option value="">選択</option>
            <option>良好</option>
            <option>注意</option>
            <option>不良</option>
          </select>
        </div>
        <div>
          <label>疲労*</label>
          <select id="d_fatigue">
            <option value="">選択</option>
            <option>なし</option>
            <option>少し</option>
            <option>強い</option>
          </select>
        </div>
      </div>

      <label>服薬・体調影響*</label>
      <select id="d_med">
        <option value="">選択</option>
        <option value="なし">なし</option>
        <option value="あり">あり</option>
      </select>

      <label>服薬内容（服薬ありの場合）</label>
      <input id="d_medDetail" placeholder="例：花粉症薬" />

      <label>飲酒の有無*</label>
      <select id="d_drink">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>酒気帯び有無*</label>
      <select id="d_alcState">
        <option value="">選択</option>
        <option>なし</option>
        <option>疑い</option>
        <option>あり</option>
      </select>

      <div class="row">
        <div>
          <label>アルコール数値*</label>
          <input id="d_alcValue" inputmode="decimal" placeholder="例：0.00" />
        </div>
        <div>
          <label>判定*</label>
          <select id="d_alcJudge">
            <option value="">選択</option>
            <option>OK</option>
            <option>NG</option>
          </select>
        </div>
      </div>

      <label>アルコール測定写真（任意・推奨）</label>
      <input id="f_alcDepImg" type="file" accept="image/*" />
      <div class="small">※端末保存しません。PDF生成時のみ使用</div>

      <label>稼働案件（メイン）*</label>
      <input id="d_projectMain" placeholder="例：Amazon / ヤマト / 企業便" />

      <label>積込拠点 / エリア*</label>
      <input id="d_area" placeholder="例：福岡営業所 / 春日周辺" />

      <label>危険物・高額品の有無*</label>
      <select id="d_danger">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>出発ODO（出発時のメーター）*</label>
      <input id="d_odoStart" inputmode="decimal" placeholder="例：123456" />

      <label>異常申告*</label>
      <select id="d_abnormal">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>異常内容（異常ありの場合は必須）</label>
      <textarea id="d_abnormalDetail" placeholder="異常がある場合は詳細を記載"></textarea>

      <label>異常写真（任意・推奨）</label>
      <input id="f_abnDepImg" type="file" accept="image/*" />

      <div class="actions" style="margin-top:12px">
        <button class="btn" id="btnSaveDep">出発点呼を保存</button>
        <button class="btn secondary" id="btnClearDep">出発点呼をクリア</button>
      </div>
    </div>

    <!-- 帰着点呼 -->
    <div class="card">
      <div class="h2">③ 帰着点呼（業務終了後）</div>
      <div class="note">
        帰着時に<strong>帰着の内容だけ</strong>入力します（出発ODOはここでは入力しません）。
      </div>

      <label>点呼日時（手入力）*</label>
      <input id="a_at" type="datetime-local" />

      <label>点呼実施方法*</label>
      <select id="a_method">
        <option value="">選択</option>
        <option>対面</option>
        <option>電話</option>
        <option>アプリ</option>
        <option>その他</option>
      </select>

      <div class="row">
        <div>
          <label>休憩時間（分）*</label>
          <input id="a_breakMin" inputmode="numeric" placeholder="例：60" />
        </div>
        <div>
          <label>体温（℃）*</label>
          <input id="a_temp" inputmode="decimal" placeholder="例：36.5" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>体調*</label>
          <select id="a_condition">
            <option value="">選択</option>
            <option>良好</option>
            <option>注意</option>
            <option>不良</option>
          </select>
        </div>
        <div>
          <label>疲労*</label>
          <select id="a_fatigue">
            <option value="">選択</option>
            <option>なし</option>
            <option>少し</option>
            <option>強い</option>
          </select>
        </div>
      </div>

      <label>服薬・体調影響*</label>
      <select id="a_med">
        <option value="">選択</option>
        <option value="なし">なし</option>
        <option value="あり">あり</option>
      </select>

      <label>服薬内容（服薬ありの場合）</label>
      <input id="a_medDetail" placeholder="例：鎮痛薬" />

      <label>酒気帯び有無*</label>
      <select id="a_alcState">
        <option value="">選択</option>
        <option>なし</option>
        <option>疑い</option>
        <option>あり</option>
      </select>

      <div class="row">
        <div>
          <label>アルコール数値*</label>
          <input id="a_alcValue" inputmode="decimal" placeholder="例：0.00" />
        </div>
        <div>
          <label>判定*</label>
          <select id="a_alcJudge">
            <option value="">選択</option>
            <option>OK</option>
            <option>NG</option>
          </select>
        </div>
      </div>

      <label>アルコール測定写真（任意・推奨）</label>
      <input id="f_alcArrImg" type="file" accept="image/*" />
      <div class="small">※端末保存しません。PDF生成時のみ使用</div>

      <label>帰着ODO（帰着時のメーター）*</label>
      <input id="a_odoEnd" inputmode="decimal" placeholder="例：123789" />

      <label>異常申告*</label>
      <select id="a_abnormal">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>異常内容（異常ありの場合は必須）</label>
      <textarea id="a_abnormalDetail" placeholder="異常がある場合は詳細を記載"></textarea>

      <label>異常写真（任意・推奨）</label>
      <input id="f_abnArrImg" type="file" accept="image/*" />

      <div class="actions" style="margin-top:12px">
        <button class="btn" id="btnSaveArr">帰着点呼を保存</button>
        <button class="btn secondary" id="btnClearArr">帰着点呼をクリア</button>
      </div>

      <div class="divider"></div>

      <div class="note">
        <span class="chip"><span class="dot" id="dotOdo"></span> <span id="odoState">走行距離：未計算</span></span>
      </div>
    </div>

    <!-- 日常点検 -->
    <div class="card">
      <div class="h2">④ 日常点検（フル：スクロール入力）</div>
      <div class="note">
        各項目を OK / NG で選択してください。NGがある場合は詳細メモ推奨です。
      </div>

      <div class="checkWrap">
        <div class="checkHeader">
          <div class="checkCol item">項目</div>
          <div class="checkCol ok">OK</div>
          <div class="checkCol ng">NG</div>
        </div>

        <div class="checkScroll" id="checkScroll"></div>
      </div>

      <label>日常点検メモ（NGがある場合は詳細推奨）</label>
      <textarea id="checkMemo" placeholder="例：タイヤ溝が浅い、ライト片側不点灯 など"></textarea>

      <label>日常点検NG写真（任意・推奨）</label>
      <input id="f_checkImg" type="file" accept="image/*" />
      <div class="small">※端末保存しません。PDF生成時のみ使用</div>
    </div>

    <!-- 日報（任意） -->
    <div class="card">
      <div class="h2">⑤ 日報（任意：入力しなくてもOK）</div>
      <div class="note">
        日報・売上系は<strong>オプション</strong>です。必要な人だけ入力してください。
      </div>

      <label>稼働日（任意）</label>
      <input id="r_date" type="date" />

      <label>稼働時間：開始（任意）</label>
      <input id="r_start" type="time" />

      <label>稼働時間：終了（任意）</label>
      <input id="r_end" type="time" />

      <label>休憩時間（分）（任意）</label>
      <input id="r_break" inputmode="numeric" placeholder="例：60" />

      <label>配達個数（任意）</label>
      <input id="r_count" inputmode="numeric" placeholder="例：120" />

      <label>不在数（任意）</label>
      <input id="r_absent" inputmode="numeric" placeholder="例：20" />

      <label>再配達数（任意）</label>
      <input id="r_redel" inputmode="numeric" placeholder="例：10" />

      <label>返品 / 持戻り数（任意）</label>
      <input id="r_return" inputmode="numeric" placeholder="例：2" />

      <label>クレーム（任意）</label>
      <select id="r_claim">
        <option value="">未選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>クレーム内容（任意）</label>
      <textarea id="r_claimDetail" placeholder="任意：内容があれば"></textarea>

      <div class="divider"></div>

      <div class="h2" style="margin-top:0;">売上・報酬（任意）</div>

      <div class="row">
        <div>
          <label>日当（任意）</label>
          <input id="r_payBase" inputmode="decimal" placeholder="例：15000" />
        </div>
        <div>
          <label>インセンティブ（任意）</label>
          <input id="r_incentive" inputmode="decimal" placeholder="例：3000" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>燃料（任意）</label>
          <input id="r_fuel" inputmode="decimal" placeholder="例：2000" />
        </div>
        <div>
          <label>高速（任意）</label>
          <input id="r_highway" inputmode="decimal" placeholder="例：800" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>駐車（任意）</label>
          <input id="r_parking" inputmode="decimal" placeholder="例：500" />
        </div>
        <div>
          <label>その他経費（任意）</label>
          <input id="r_otherCost" inputmode="decimal" placeholder="例：300" />
        </div>
      </div>

      <label>メモ（任意）</label>
      <textarea id="r_memo" placeholder="任意：気づき・報告"></textarea>

      <label>日報写真（任意：PDFに埋め込み）</label>
      <input id="f_dailyImg" type="file" accept="image/*" />
      <div class="small">※端末保存しません。PDF生成時のみ使用</div>

      <div class="divider"></div>

      <div class="h2" style="margin-top:0;">複数案件（任意：追加式）</div>
      <div class="note">
        1案件の人は入力不要。複数案件の人だけ追加してください。
      </div>

      <div id="projectsBox"></div>
      <button class="btn secondary" id="btnAddProject">＋ 案件を追加</button>
    </div>

    <!-- 出力 -->
    <div class="card">
      <div class="h2">⑥ 出力（PDF / CSV）</div>
      <div class="note">
        PDFは端末内で生成して保存します。iPhoneは保存後に「共有」からLINE/メール送信してください。
      </div>

      <div class="actions">
        <button class="btn" id="btnMakePdf">今日のPDF（点呼＋日報）</button>
        <button class="btn secondary" id="btnMakeCsv">CSV出力（全履歴）</button>
      </div>

      <div class="divider"></div>

      <div class="note">
        <span class="chip"><span class="dot ok"></span> PDFを保存したら「ファイル」→共有でLINE送信</span>
      </div>
    </div>

    <!-- 履歴 -->
    <div class="card">
      <div class="h2">⑦ 履歴（端末内）</div>
      <div class="note">
        端末内の履歴です（IndexedDB）。1000件超でも動作します。
      </div>

      <div class="actions">
        <button class="btn secondary inline" id="btnReloadHistory">更新</button>
        <button class="btn secondary inline" id="btnClearAll">全削除（注意）</button>
      </div>

      <div id="historyBox"></div>
    </div>

  </div>

  <!-- 問い合わせ（固定） -->
  <div class="floatingHelp">
    <a href="https://lin.ee/7sO7SCQ">
      <button class="btn">OFAメンバー専用LINEへ問い合わせ</button>
    </a>
  </div>

  <!-- JS -->
<script src="./js/db.js?v=20260124"></script>
<script src="./js/pdf.js?v=20260124"></script>
<script src="./js/csv.js?v=20260124"></script>
<script src="./js/app.js?v=20260124"></script>
</body>
</html>
