<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OFA 点呼システム</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body data-page="home">
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">OFA 点呼システム</div>
          <div class="subtitle">出発点呼 / 帰着点呼・日報 / PDF・月報・CSV</div>
        </div>
      </div>
      <span id="badge" class="badge gray">未ログイン</span>
    </div>

    <div class="card">
      <div class="titleSm">点呼の重要ルール（必読）</div>
      <ul class="bullets">
        <li>点呼は <b>業務開始前（出発）</b> と <b>業務終了後（帰着）</b> の2回</li>
        <li>アルコールチェックは <b>数値必須</b>（写真は任意）</li>
        <li>免許番号は <b>必須</b>（写真は任意）</li>
        <li>車両点検も必須（NG時は異常箇所写真推奨）</li>
        <li>帰着点呼の日報はPDF提出されるため丁寧に記載</li>
      </ul>
    </div>

    <div class="card rainbow-border">
      <div class="titleSm">ログイン（パスワード）</div>
      <p class="hint">
        パスワードは社内LINEで案内します。分からない場合はLINE公式から確認してください。
      </p>

      <div class="grid grid2">
        <div>
          <label>パスワード <span class="req">*</span></label>
          <input id="pass" type="password" placeholder="パスワードを入力" autocomplete="current-password" />
        </div>
        <div>
          <label>パスワード確認</label>
          <a class="btn dark" href="https://lin.ee/8dsZjAo" target="_blank" rel="noopener">LINE公式で確認</a>
        </div>
      </div>

      <div class="btnrow">
        <button class="btn rainbow" id="btnDriver" type="button">ドライバーでログイン</button>
        <button class="btn dark" id="btnAdmin" type="button">管理者でログイン</button>
      </div>

      <hr class="sep">

      <div class="btnrow">
        <a class="btn ghost" href="./departure.html">出発点呼へ</a>
        <a class="btn ghost" href="./arrival.html">帰着点呼 / 日報へ</a>
        <a class="btn ghost" href="./export.html">出力（本人/管理）へ</a>
      </div>

      <small class="hint">
        ※ 未ログインでもページは開けますが、送信/出力はログイン必須です。
      </small>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <script src="./config.js"></script>
  <script src="./auth.js"></script>
  <script>
    const badge = document.getElementById("badge");
    const pass = document.getElementById("pass");
    const btnDriver = document.getElementById("btnDriver");
    const btnAdmin = document.getElementById("btnAdmin");

    function renderBadge(){
      const s = Auth.getSession();
      if(!s){ badge.textContent="未ログイン"; badge.className="badge gray"; return; }
      badge.textContent = s.role === "admin" ? "管理者" : "ドライバー";
      badge.className = "badge " + (s.role === "admin" ? "red" : "green");
    }

    btnDriver.onclick = () => {
      const p = (pass.value||"").trim();
      if(Auth.loginDriver(p)) { toast("ログインしました（ドライバー）"); renderBadge(); }
      else toast("パスワードが違います");
    };

    btnAdmin.onclick = () => {
      const p = (pass.value||"").trim();
      if(Auth.loginAdmin(p)) { toast("ログインしました（管理者）"); renderBadge(); }
      else toast("パスワードが違います");
    };

    renderBadge();
  </script>
</body>
</html>
