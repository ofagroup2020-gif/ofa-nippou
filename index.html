<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>OFA 点呼 / 日報</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>

  <div class="header">
    <div class="logoBox">
      <img class="logoImg" src="https://ofagroup2020-gif.github.io/logo.png" alt="OFA">
    </div>
    <div class="titlewrap">
      <div class="title">OFA 点呼 / 日報</div>
      <div class="subtitle">端末内保存（IndexedDB）＋ PDF/CSV出力（アップロードなし）</div>
    </div>
    <a href="./admin/index.html"><button class="rightTopBtn">管理者</button></a>
  </div>

  <div class="container">

    <!-- 0. 連絡導線 -->
    <div class="card">
      <div class="h2">問い合わせ</div>
      <div class="note">
        パスワードや運用確認はメンバー専用LINEからお願いします。
      </div>
      <a href="https://lin.ee/7sO7SCQ">
        <button class="btn secondary">OFAメンバー専用LINEへ問い合わせ</button>
      </a>
    </div>

    <!-- 1. 基本情報 -->
    <div class="card" id="profileCard">
      <div class="h2">① 基本情報（必須）</div>
      <div class="note">
        ここで保存した情報は、点呼・日報に自動反映されます（端末内保存のみ）。
      </div>

      <label>氏名（本名）*</label>
      <input id="p_name" placeholder="例：森下 洸" />

      <label>拠点（47都道府県 or 自由記入）*</label>
      <input id="p_base" placeholder="例：鹿児島 / 東京都" />

      <label>車両番号（ナンバー）*</label>
      <input id="p_carNo" placeholder="例：鹿児島 480 れ 21-15" />

      <label>運転免許証番号*</label>
      <input id="p_licenseNo" placeholder="例：第1234567890号" />

      <div class="row">
        <div>
          <label>電話番号*</label>
          <input id="p_phone" placeholder="080..." />
        </div>
        <div>
          <label>メールアドレス*</label>
          <input id="p_email" placeholder="example@..." />
        </div>
      </div>

      <label>運転免許証写真（任意：PDFに埋め込み／保存しない）</label>
      <input id="p_licenseImg" type="file" accept="image/*" />
      <div class="small">※画像は端末保存しません。PDF作成時だけ使用します。</div>

      <div class="actions">
        <button class="btn" id="btnSaveProfile">基本情報を保存</button>
        <button class="btn secondary" id="btnLoadProfile">保存内容を読み込み</button>
      </div>

      <div class="divider"></div>

      <div class="small">
        ✅ まずここを保存すると、下の点呼へ進めます。
      </div>
    </div>

    <!-- 2. 点呼（出発） -->
    <div class="card" id="depCard">
      <div class="h2">② 出発点呼（業務開始前）</div>
      <div class="note">
        出発時は <b>出発ODO</b> を入力。帰着ODOはここでは入力しません。
      </div>

      <label>点呼日時（手入力）*</label>
      <input id="dep_at" type="datetime-local" />

      <label>点呼実施方法*</label>
      <select id="dep_method">
        <option value="">選択</option>
        <option>対面</option>
        <option>電話</option>
        <option>アプリ</option>
        <option>その他</option>
      </select>

      <div class="row">
        <div>
          <label>睡眠時間（h）*</label>
          <input id="dep_sleep" type="number" step="0.5" min="0" max="24" placeholder="例：6.0" />
        </div>
        <div>
          <label>体温（℃）*</label>
          <input id="dep_temp" type="number" step="0.1" placeholder="例：36.5" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>体調*</label>
          <select id="dep_condition">
            <option value="">選択</option>
            <option>良好</option>
            <option>注意</option>
            <option>不良</option>
          </select>
        </div>
        <div>
          <label>疲労*</label>
          <select id="dep_fatigue">
            <option value="">選択</option>
            <option>なし</option>
            <option>少し</option>
            <option>強い</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>服薬（体調影響）*</label>
          <select id="dep_med">
            <option value="">選択</option>
            <option>なし</option>
            <option>あり</option>
          </select>
        </div>
        <div>
          <label>服薬内容（ありの場合）</label>
          <input id="dep_medDetail" placeholder="例：風邪薬" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>飲酒の有無*</label>
          <select id="dep_drink">
            <option value="">選択</option>
            <option>なし</option>
            <option>あり</option>
          </select>
        </div>
        <div>
          <label>酒気帯び*</label>
          <select id="dep_alcBand">
            <option value="">選択</option>
            <option>なし</option>
            <option>疑い</option>
            <option>あり</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>アルコール数値*</label>
          <input id="dep_alcValue" type="number" step="0.01" placeholder="例：0.00" />
        </div>
        <div>
          <label>アルコール判定*</label>
          <select id="dep_alcJudge">
            <option value="">選択</option>
            <option>OK</option>
            <option>NG</option>
          </select>
        </div>
      </div>

      <label>アルコール測定写真（任意：PDFに埋め込み／保存しない）</label>
      <input id="dep_alcImg" type="file" accept="image/*" />

      <label>出発ODO*</label>
      <input id="dep_odoStart" type="number" step="1" placeholder="例：12345" />

      <label>稼働案件（複数追加）*</label>
      <div id="dep_projects"></div>
      <button class="btn secondary" id="btnAddProjectDep">＋案件を追加</button>

      <label>積込拠点/エリア*</label>
      <input id="dep_area" placeholder="例：姶良市 / 福岡市" />

      <label>危険物・高額品の有無*</label>
      <select id="dep_risky">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>異常申告*</label>
      <select id="dep_abnormal">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>異常内容（ありの場合は必須）</label>
      <textarea id="dep_abnormalDetail" placeholder="例：発熱、車両異常、遅延要因など"></textarea>

      <label>異常写真（任意：PDFに埋め込み／保存しない）</label>
      <input id="dep_abnormalImg" type="file" accept="image/*" />

      <div class="actions">
        <button class="btn" id="btnSaveDep">出発点呼を保存</button>
      </div>
    </div>

    <!-- 3. 点呼（帰着） -->
    <div class="card" id="arrCard">
      <div class="h2">③ 帰着点呼（業務終了後）</div>
      <div class="note">
        帰着時は <b>帰着ODO</b> を入力。出発ODOはここでは入力しません。<br>
        走行距離は「同日の出発ODO」と「帰着ODO」から自動で差分計算します。
      </div>

      <label>点呼日時（手入力）*</label>
      <input id="arr_at" type="datetime-local" />

      <label>点呼実施方法*</label>
      <select id="arr_method">
        <option value="">選択</option>
        <option>対面</option>
        <option>電話</option>
        <option>アプリ</option>
        <option>その他</option>
      </select>

      <div class="row">
        <div>
          <label>休憩時間（分）*</label>
          <input id="arr_break" type="number" step="1" min="0" placeholder="例：60" />
        </div>
        <div>
          <label>体温（℃）*</label>
          <input id="arr_temp" type="number" step="0.1" placeholder="例：36.5" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>体調*</label>
          <select id="arr_condition">
            <option value="">選択</option>
            <option>良好</option>
            <option>注意</option>
            <option>不良</option>
          </select>
        </div>
        <div>
          <label>疲労*</label>
          <select id="arr_fatigue">
            <option value="">選択</option>
            <option>なし</option>
            <option>少し</option>
            <option>強い</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>服薬（体調影響）*</label>
          <select id="arr_med">
            <option value="">選択</option>
            <option>なし</option>
            <option>あり</option>
          </select>
        </div>
        <div>
          <label>服薬内容（ありの場合）</label>
          <input id="arr_medDetail" placeholder="例：風邪薬" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>飲酒の有無*</label>
          <select id="arr_drink">
            <option value="">選択</option>
            <option>なし</option>
            <option>あり</option>
          </select>
        </div>
        <div>
          <label>酒気帯び*</label>
          <select id="arr_alcBand">
            <option value="">選択</option>
            <option>なし</option>
            <option>疑い</option>
            <option>あり</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>アルコール数値*</label>
          <input id="arr_alcValue" type="number" step="0.01" placeholder="例：0.00" />
        </div>
        <div>
          <label>アルコール判定*</label>
          <select id="arr_alcJudge">
            <option value="">選択</option>
            <option>OK</option>
            <option>NG</option>
          </select>
        </div>
      </div>

      <label>アルコール測定写真（任意：PDFに埋め込み／保存しない）</label>
      <input id="arr_alcImg" type="file" accept="image/*" />

      <label>帰着ODO*</label>
      <input id="arr_odoEnd" type="number" step="1" placeholder="例：12500" />

      <!-- 日常点検（フル） -->
      <div class="divider"></div>
      <div class="h2">④ 日常点検（必須：スクロール入力）</div>
      <div class="note">
        OK/NG を選択。NGが1つでもある場合は「NG詳細メモ」を必須にします。
      </div>

      <div class="checkScroll" id="checklistBox"></div>

      <label>NG詳細メモ（NGがある場合は必須）</label>
      <textarea id="checkMemo" placeholder="例：タイヤ溝が少ない、ライト不点灯など"></textarea>

      <label>NG写真（任意：推奨／PDFに埋め込み・保存しない）</label>
      <input id="checkImg" type="file" accept="image/*" />

      <div class="divider"></div>

      <label>異常申告*</label>
      <select id="arr_abnormal">
        <option value="">選択</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>異常内容（ありの場合は必須）</label>
      <textarea id="arr_abnormalDetail" placeholder="例：物損、遅延、体調不良など"></textarea>

      <label>異常写真（任意：PDFに埋め込み／保存しない）</label>
      <input id="arr_abnormalImg" type="file" accept="image/*" />

      <div class="actions">
        <button class="btn" id="btnSaveArr">帰着点呼＋日常点検を保存</button>
      </div>
    </div>

    <!-- 5. 日報（任意） -->
    <div class="card" id="dailyCard">
      <div class="h2">⑤ 日報（任意：使いたい人だけ）</div>
      <div class="note">
        日報/売上は <b>オプション</b> です。未入力でもOK。<br>
        ただし入力すると、PDF/CSV/集計に反映されます。
      </div>

      <label>稼働日（任意）</label>
      <input id="d_date" type="date" />

      <label>案件（メイン：任意）</label>
      <input id="d_mainProject" placeholder="例：Amazon" />

      <label>稼働時間（任意）</label>
      <div class="row">
        <div>
          <label>開始</label>
          <input id="d_workStart" type="time" />
        </div>
        <div>
          <label>終了</label>
          <input id="d_workEnd" type="time" />
        </div>
      </div>

      <label>休憩時間（分：任意）</label>
      <input id="d_break" type="number" step="1" min="0" placeholder="例：60" />

      <label>配達個数（任意）</label>
      <input id="d_count" type="number" step="1" min="0" placeholder="例：179" />

      <div class="row">
        <div>
          <label>不在数（任意）</label>
          <input id="d_absent" type="number" step="1" min="0" />
        </div>
        <div>
          <label>再配達数（任意）</label>
          <input id="d_redel" type="number" step="1" min="0" />
        </div>
      </div>

      <label>クレーム（任意）</label>
      <select id="d_claim">
        <option value="">未入力</option>
        <option>なし</option>
        <option>あり</option>
      </select>

      <label>クレーム内容（ありの場合）</label>
      <textarea id="d_claimDetail"></textarea>

      <div class="divider"></div>
      <div class="h2">売上・報酬（任意）</div>

      <div class="row">
        <div>
          <label>日当（任意）</label>
          <input id="d_payBase" type="number" step="1" min="0" placeholder="例：18000" />
        </div>
        <div>
          <label>インセンティブ（任意）</label>
          <input id="d_incentive" type="number" step="1" min="0" placeholder="例：2000" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>燃料（任意）</label>
          <input id="d_fuel" type="number" step="1" min="0" />
        </div>
        <div>
          <label>高速（任意）</label>
          <input id="d_highway" type="number" step="1" min="0" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>駐車（任意）</label>
          <input id="d_parking" type="number" step="1" min="0" />
        </div>
        <div>
          <label>その他経費（任意）</label>
          <input id="d_otherCost" type="number" step="1" min="0" />
        </div>
      </div>

      <label>日報メモ（任意）</label>
      <textarea id="d_memo"></textarea>

      <div class="actions">
        <button class="btn secondary" id="btnSaveDaily">日報を保存（任意）</button>
      </div>
    </div>

    <!-- 6. 出力 -->
    <div class="card">
      <div class="h2">⑥ 出力（PDF / CSV）</div>
      <div class="note">
        PDFは端末内で生成し、iPhoneの共有からLINE/メールへ送れます。
      </div>

      <div class="row">
        <div>
          <label>対象日（PDF用）</label>
          <input id="out_date" type="date" />
        </div>
        <div>
          <label>検索期間（CSV用：開始）</label>
          <input id="out_from" type="date" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>検索期間（CSV用：終了）</label>
          <input id="out_to" type="date" />
        </div>
        <div>
          <label>拠点（部分一致）</label>
          <input id="out_base" placeholder="例：鹿児島" />
        </div>
      </div>

      <label>氏名（部分一致）</label>
      <input id="out_name" placeholder="例：森下" />

      <div class="actions">
        <button class="btn" id="btnPdfToday">PDF作成（対象日）</button>
        <button class="btn secondary" id="btnCsvRange">CSV出力（期間検索）</button>
      </div>

      <div class="small">
        ※日付を指定しない場合は「最新の出発/帰着」を自動採用します。
      </div>
    </div>

    <!-- 7. 履歴 -->
    <div class="card">
      <div class="h2">⑦ 履歴（端末内）</div>
      <div class="note">
        端末内の履歴を表示します（1000件超対応）。<br>
        ※端末を変えると履歴は別になります（アップロードなし運用）。
      </div>

      <div class="actions">
        <button class="btn secondary" id="btnReloadHistory">履歴を更新</button>
        <button class="btn secondary" id="btnClearAll">⚠️ 全履歴を削除（この端末）</button>
      </div>

      <div class="divider"></div>
      <div id="historyBox"></div>
    </div>

  </div>

  <!-- libs / app -->
  <script src="./js/db.js"></script>
  <script src="./js/pdf.js"></script>
  <script src="./js/csv.js"></script>
  <script src="./js/app.js"></script>

</body>
</html>
