<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OFA GROUP 車両報告書 作成</title>

  <!-- キャッシュ対策：手動で数字を変えると確実に反映 -->
  <link rel="stylesheet" href="./styles.css?v=20260127_01" />

  <!-- libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- app -->
  <script defer src="./pdf.js?v=20260127_01"></script>
  <script defer src="./script.js?v=20260127_01"></script>
</head>

<body>
  <!-- ヘッダー -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">OFA</div>
      <div class="brandText">
        <div class="brandTitle">OFA GROUP</div>
        <div class="brandSub">株式会社OFA 車両管理</div>
      </div>
    </div>
    <div class="status">
      <span class="dot"></span>
      <span id="nowText">--</span>
    </div>
  </header>

  <main class="container">
    <!-- 説明 -->
    <section class="card cardBlue">
      <h2>車両報告書 作成</h2>
      <p class="desc">
        貸出 / 返却 / 定期点検 の記録を「写真埋め込みPDF（報告書）」として作成し、LINE共有・印刷に使用できます。<br>
        ※入力データ・写真は保存しません（端末内でPDF生成）。
      </p>
    </section>

    <!-- 種別 -->
    <section class="card">
      <h2>種別選択</h2>
      <div class="tabRow" role="tablist" aria-label="種別選択">
        <button class="tab active" data-type="loan" type="button">貸出</button>
        <button class="tab" data-type="return" type="button">返却</button>
        <button class="tab" data-type="inspect" type="button">定期点検</button>
      </div>
      <p class="hint">
        ※タブ切替時は入力を全てリセットし、常に最新データで作成します。
      </p>
    </section>

    <!-- 基本情報 -->
    <section class="card">
      <h2>基本情報</h2>

      <div class="grid2">
        <div class="field">
          <label>管理番号（自動生成）</label>
          <input id="manageNo" type="text" placeholder="自動生成されます" readonly>
          <div class="mini">例：OFA-46-20260126-025501-8F2A</div>
        </div>

        <div class="field">
          <label>作成日時（自動）</label>
          <input id="createdAt" type="text" readonly>
          <div class="mini">※変更できません</div>
        </div>

        <div class="field">
          <label>拠点（都道府県）<span class="req">必須</span></label>
          <select id="pref" required></select>
          <div class="mini">拠点コードは自動付与され、PDFに記載されます</div>
        </div>

        <div class="field">
          <label>拠点コード（自動）</label>
          <input id="prefCode" type="text" placeholder="自動" readonly>
        </div>

        <div class="field">
          <label>車両ナンバー<span class="req">必須</span></label>
          <input id="plateNo" type="text" placeholder="例）鹿児島 480 あ 12-34" required>
        </div>

        <div class="field">
          <label>車体番号（車台番号）<span class="req">必須</span></label>
          <input id="vin" type="text" placeholder="例）EBD-DA17V-123456" required>
        </div>

        <div class="field">
          <label>走行距離（km）<span class="req">必須</span></label>
          <input id="odometer" type="number" inputmode="numeric" placeholder="例）12345" required>
        </div>

        <div class="field">
          <label>給油状況<span class="req">必須</span></label>
          <select id="fuel" required>
            <option value="">選択</option>
            <option>満タン</option>
            <option>3/4</option>
            <option>1/2</option>
            <option>1/4</option>
            <option>ほぼ空</option>
          </select>
        </div>

        <div class="field">
          <label>利用者 氏名<span class="req">必須</span></label>
          <input id="userName" type="text" placeholder="例）森下 洸" required>
        </div>

        <div class="field">
          <label>契約用メールアドレス<span class="req">必須</span></label>
          <input id="email" type="email" inputmode="email" placeholder="example@gmail.com" required>
        </div>

        <div class="field span2">
          <label>備考（任意）</label>
          <textarea id="note" rows="3" placeholder="例）傷の位置、返却時の伝達事項など"></textarea>
        </div>
      </div>
    </section>

    <!-- 写真（グループ化） -->
    <section class="card">
      <div class="rowBetween">
        <h2>写真（必須）</h2>
        <div class="badge" id="photoProgress">0 / 0</div>
      </div>
      <p class="hint">
        ※未添付があるとPDF作成できません。すべて撮影・添付してください。
      </p>

      <div class="photoGroups" id="photoGroups"></div>
    </section>

    <!-- 日常点検（15項目） -->
    <section class="card" id="dailyCheckCard">
      <div class="rowBetween">
        <h2>日常点検（15項目）</h2>
        <div class="badge" id="checkProgress">0 / 15</div>
      </div>
      <p class="hint">※点検した項目にチェックしてください（定期点検時は必須）。</p>

      <div class="checkList" id="checkList"></div>
    </section>

    <!-- 状態確認 -->
    <section class="card">
      <h2>車両状態の確認（必須）</h2>
      <ul class="bullets">
        <li>貸出 / 返却時に、写真と記録を提出し状態確認を行います。</li>
        <li>事故・破損・異常が発生した場合は速やかに当社へ報告します。</li>
        <li>返却時は原則として貸出時と同等の状態で返却します。</li>
        <li>損傷・汚損等が確認された場合、修理費等が発生する場合があります。</li>
      </ul>

      <label class="agree">
        <input id="agree" type="checkbox">
        <span>上記内容を確認し、状態確認を行いました（必須）</span>
      </label>
    </section>

    <!-- 署名 -->
    <section class="card">
      <div class="rowBetween">
        <h2>署名（必須）</h2>
        <button class="btn small danger" id="btnClearSign" type="button">署名クリア</button>
      </div>
      <p class="hint">※指で署名できます（iPhone対応）。PDFの右下に小さく挿入されます。</p>

      <div class="signWrap">
        <canvas id="signPad" width="900" height="300" aria-label="署名欄"></canvas>
      </div>
    </section>

    <!-- 問い合わせ（ボタンのみ） -->
    <section class="card cardGreen">
      <h2>問い合わせ先</h2>
      <p class="desc">お問い合わせは、OFAメンバーシップLINEからお願いします。</p>
      <a class="btnLineBig" id="lineLink" href="https://lin.ee/ZsC6sxs" target="_blank" rel="noopener">
        OFAメンバーシップLINEを開く
      </a>
      <p class="mini">※開かない場合は、URLをコピーしてLINEで開いてください。</p>
    </section>

    <!-- 印刷説明 / キャッシュ対策 -->
    <section class="card cardYellow">
      <h2>印刷について</h2>
      <p class="desc">
        印刷やPDF保存で「切れる」場合は、印刷設定で <b>余白：標準</b> または <b>最小</b> をお試しください。<br>
        本ツールはA4自動改ページで作成します。
      </p>
      <button class="btn ghost" id="btnHardReload" type="button">反映されない時（キャッシュ対策）</button>
    </section>

    <!-- PDF生成用のステージ（非表示） -->
    <div id="pdfStage" aria-hidden="true"></div>

    <div class="spacer"></div>
  </main>

  <!-- 下部メニュー -->
  <nav class="bottomBar" id="bottomBar">
    <button class="btn primary" id="btnMakePdf" type="button">PDFを作成</button>
    <button class="btn green" id="btnShareLine" type="button">LINEに送る</button>
    <button class="btn dark" id="btnDownload" type="button">PDFダウンロード</button>
  </nav>

  <!-- トースト -->
  <div class="toast" id="toast"></div>
</body>
</html>
