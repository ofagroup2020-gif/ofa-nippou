<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>OFA 日報＆月次実績ツール（取引先×荷物種別＋単価設定）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f5f5f5;
    }
    header {
      background: #222;
      color: #ffd700;
      padding: 10px 16px;
      font-size: 16px;
    }
    .container {
      max-width: 980px;
      margin: 0 auto;
      padding: 12px 12px 24px;
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 12px;
    }
    .tab-btn {
      flex: 1;
      padding: 8px;
      font-size: 13px;
      border: none;
      border-radius: 4px 4px 0 0;
      background: #ddd;
      cursor: pointer;
    }
    .tab-btn.active {
      background: #fff;
      border-bottom: 2px solid #ffd700;
      font-weight: bold;
    }
    .panel {
      display: none;
      background: #fff;
      border-radius: 0 4px 4px 4px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.06);
    }
    .panel.active {
      display: block;
    }
    h2 {
      font-size: 15px;
      margin: 0 0 8px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      margin-bottom: 12px;
    }
    label {
      font-size: 12px;
      display: block;
      margin-bottom: 2px;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="month"],
    select {
      padding: 4px 6px;
      font-size: 13px;
      border-radius: 4px;
      border: 1px solid #ccc;
      min-width: 140px;
    }
    input[type="number"] { text-align: right; }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 8px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px;
      text-align: right;
    }
    th:first-child, td:first-child { text-align: left; }
    th {
      background: #fafafa;
    }
    tfoot td {
      font-weight: bold;
      background: #fff8d6;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      padding: 4px 6px;
      font-size: 12px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0;
    }
    button {
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .btn-main { background: #ffd700; }
    .btn-sub { background: #eee; }
    .btn-danger { background: #ffcccc; }
    .note {
      font-size: 10px;
      color: #666;
      margin-top: 4px;
    }
    .badge {
      display: inline-block;
      background: #222;
      color: #ffd700;
      padding: 2px 6px;
      font-size: 10px;
      border-radius: 3px;
      margin-left: 4px;
    }
    .sum-box {
      font-size: 13px;
      margin-top: 4px;
    }
    .sum-box span {
      font-weight: bold;
    }
    @media (max-width:600px) {
      input[type="text"],
      input[type="number"],
      input[type="date"],
      input[type="month"],
      select {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<header>
  OFA 日報入力 &amp; 月次実績表（取引先 × 荷物種別 ＋ 単価設定）
</header>
<div class="container">
  <div class="tabs">
    <button class="tab-btn active" data-target="tab-daily">日報入力</button>
    <button class="tab-btn" data-target="tab-unit">単価設定</button>
    <button class="tab-btn" data-target="tab-monthly">月次実績</button>
    <button class="tab-btn" data-target="tab-data">データ管理</button>
  </div>

  <!-- 日報入力 -->
  <div id="tab-daily" class="panel active">
    <h2>日報入力 <span class="badge">単価は「単価設定」から一括読み込み</span></h2>
    <div class="row">
      <div>
        <label for="dDate">日付</label>
        <input type="date" id="dDate">
      </div>
      <div>
        <label for="dName">氏名</label>
        <input type="text" id="dName" placeholder="氏名">
      </div>
      <div>
        <label for="dArea">エリア</label>
        <input type="text" id="dArea" placeholder="例：鹿児島市伊敷">
      </div>
    </div>
    <div class="row">
      <div>
        <label for="dClient">取引先</label>
        <select id="dClient">
          <option value="">--選択--</option>
          <option>ヤマト運輸</option>
          <option>佐川急便</option>
          <option>日本郵便</option>
          <option>西濃運輸</option>
          <option>福山通運</option>
          <option>Amazon（SBS）</option>
          <option>Amazon（丸和）</option>
          <option>Amazon（祇園）</option>
          <option>その他</option>
        </select>
      </div>
      <div style="align-self:flex-end;">
        <button class="btn-sub" id="btnLoadUnitsFromSetting">この取引先の単価を読み込む</button>
      </div>
    </div>

    <h3 style="font-size:13px;margin:8px 0 4px;">荷物種別ごとの運賃設定</h3>
    <table>
      <thead>
        <tr>
          <th style="width:150px;">荷物種別</th>
          <th style="width:90px;">単価（円）</th>
          <th style="width:80px;">数量</th>
          <th style="width:100px;">小計（円）</th>
        </tr>
      </thead>
      <tbody>
        <tr data-key="一般荷物（宅配）">
          <td>一般荷物（宅配）</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="一般荷物（宅配）"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="一般荷物（宅配）"></td>
          <td class="sub" data-key="一般荷物（宅配）">0</td>
        </tr>
        <tr data-key="ポスティング">
          <td>ポスティング</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="ポスティング"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="ポスティング"></td>
          <td class="sub" data-key="ポスティング">0</td>
        </tr>
        <tr data-key="メール">
          <td>メール</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="メール"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="メール"></td>
          <td class="sub" data-key="メール">0</td>
        </tr>
        <tr data-key="一般集荷">
          <td>一般集荷</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="一般集荷"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="一般集荷"></td>
          <td class="sub" data-key="一般集荷">0</td>
        </tr>
        <tr data-key="代引き">
          <td>代引き</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="代引き"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="代引き"></td>
          <td class="sub" data-key="代引き">0</td>
        </tr>
        <tr data-key="チャーター便">
          <td>チャーター便</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="チャーター便"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="チャーター便" placeholder="通常は1日1件なら1"></td>
          <td class="sub" data-key="チャーター便">0</td>
        </tr>
        <tr data-key="スポット便">
          <td>スポット便</td>
          <td><input type="number" min="0" step="1" class="unit" data-key="スポット便"></td>
          <td><input type="number" min="0" step="1" class="qty" data-key="スポット便"></td>
          <td class="sub" data-key="スポット便">0</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td>合計</td>
          <td id="sum-unit" style="text-align:right;">-</td>
          <td id="sum-qty" style="text-align:right;">0</td>
          <td id="sum-amount" style="text-align:right;">0</td>
        </tr>
      </tfoot>
    </table>
    <div class="sum-box">この日の売上合計：<span id="dDayTotalBig">0</span> 円</div>

    <div style="margin-top:8px;">
      <label for="dMemo">メモ（クレーム・遅延・事故・備考など）</label>
      <textarea id="dMemo"></textarea>
    </div>

    <div class="btn-row">
      <button class="btn-main" id="btnSave">この日を保存 / 上書き</button>
      <button class="btn-sub" id="btnLoad">この日を読み込み</button>
      <button class="btn-sub" id="btnToday">今日</button>
      <button class="btn-danger" id="btnClearDay">この日のデータ削除</button>
    </div>
    <div class="note">
      データはこのブラウザ内（LocalStorage）に保存されます。端末やブラウザを変えると共有されません。
    </div>
  </div>

  <!-- 単価設定 -->
  <div id="tab-unit" class="panel">
    <h2>単価設定 <span class="badge">取引先 × 荷物種別ごとに事前登録</span></h2>
    <div class="row">
      <div>
        <label for="uClient">取引先</label>
        <select id="uClient">
          <option value="">--選択--</option>
          <option>ヤマト運輸</option>
          <option>佐川急便</option>
          <option>日本郵便</option>
          <option>西濃運輸</option>
          <option>福山通運</option>
          <option>Amazon（SBS）</option>
          <option>Amazon（丸和）</option>
          <option>Amazon（祇園）</option>
          <option>その他</option>
        </select>
      </div>
      <div style="align-self:flex-end;">
        <button class="btn-sub" id="btnUnitLoad">読み込み</button>
        <button class="btn-main" id="btnUnitSave">保存</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:160px;">荷物種別</th>
          <th style="width:100px;">単価（円）</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>一般荷物（宅配）</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="一般荷物（宅配）"></td>
        </tr>
        <tr>
          <td>ポスティング</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="ポスティング"></td>
        </tr>
        <tr>
          <td>メール</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="メール"></td>
        </tr>
        <tr>
          <td>一般集荷</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="一般集荷"></td>
        </tr>
        <tr>
          <td>代引き</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="代引き"></td>
        </tr>
        <tr>
          <td>チャーター便</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="チャーター便"></td>
        </tr>
        <tr>
          <td>スポット便</td>
          <td><input type="number" min="0" step="1" class="u-unit" data-key="スポット便"></td>
        </tr>
      </tbody>
    </table>
    <div class="note">
      例）ヤマト運輸：宅配165円、代引き190円、ポスティング64円…などを登録しておくと、日報入力画面で「この取引先の単価を読み込む」ボタンで自動反映されます。
    </div>
  </div>

  <!-- 月次実績 -->
  <div id="tab-monthly" class="panel">
    <h2>月次実績 表示・集計</h2>
    <div class="row">
      <div>
        <label for="mMonth">表示月</label>
        <input type="month" id="mMonth">
      </div>
      <div style="align-self:flex-end;">
        <button class="btn-main" id="btnShowMonth">この月の実績を表示</button>
      </div>
      <div style="align-self:flex-end;">
        <button class="btn-sub" id="btnExportCsv">CSVダウンロード</button>
      </div>
    </div>
    <div id="monthlyResult"></div>
    <div class="note">
      日別に「取引先 × 荷物種別」の数量と売上、月合計を表示します。
    </div>
  </div>

  <!-- データ管理 -->
  <div id="tab-data" class="panel">
    <h2>データ管理（バックアップ・復元）</h2>
    <p style="font-size:12px;">
      保存済み日報データ（LocalStorage）のバックアップと復元ができます。
    </p>
    <div class="btn-row">
      <button class="btn-sub" id="btnBackup">バックアップ（JSON表示）</button>
      <button class="btn-sub" id="btnImport">JSONから復元</button>
      <button class="btn-danger" id="btnAllClear">全データ削除</button>
    </div>
    <textarea id="dataArea" placeholder="バックアップJSONの表示・貼り付け欄"></textarea>
    <div class="note">
      JSONをコピーしてメモ帳などに保存しておくと、端末変更時などに貼り付けて復元できます。
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = "ofa_nippou_client_item_v2";
  const UNIT_KEY = "ofa_unit_settings_client_item_v1";
  const itemKeys = ["一般荷物（宅配）","ポスティング","メール","一般集荷","代引き","チャーター便","スポット便"];

  function formatNumber(n) { return n.toLocaleString("ja-JP"); }
  function loadAllRecords() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      return JSON.parse(raw);
    } catch (e) { console.error(e); return {}; }
  }
  function saveAllRecords(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }
  function loadUnitSettings() {
    try {
      const raw = localStorage.getItem(UNIT_KEY);
      if (!raw) return {};
      return JSON.parse(raw);
    } catch (e) { console.error(e); return {}; }
  }
  function saveUnitSettings(settings) {
    localStorage.setItem(UNIT_KEY, JSON.stringify(settings));
  }
  function ymdFromDateStr(str) {
    if (!str) return null;
    const [y,m,d] = str.split("-").map(s => parseInt(s,10));
    if (!y || !m || !d) return null;
    return {y,m,d};
  }
  function getYoubi(str) {
    const info = ymdFromDateStr(str);
    if (!info) return "";
    const dt = new Date(info.y, info.m-1, info.d);
    const arr = ["日","月","火","水","木","金","土"];
    return arr[dt.getDay()];
  }

  // Tabs
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.target).classList.add("active");
    });
  });

  function recalcDaily() {
    let sumQty = 0;
    let sumAmount = 0;
    itemKeys.forEach(key => {
      const unitEl = document.querySelector('.unit[data-key="'+key+'"]');
      const qtyEl = document.querySelector('.qty[data-key="'+key+'"]');
      const subEl = document.querySelector('.sub[data-key="'+key+'"]');
      const unit = parseFloat(unitEl.value) || 0;
      const qty = parseFloat(qtyEl.value) || 0;
      const sub = unit * qty;
      subEl.textContent = formatNumber(sub);
      sumQty += qty;
      sumAmount += sub;
    });
    document.getElementById("sum-qty").textContent = formatNumber(sumQty);
    document.getElementById("sum-amount").textContent = formatNumber(sumAmount);
    document.getElementById("sum-unit").textContent = "-";
    document.getElementById("dDayTotalBig").textContent = formatNumber(sumAmount);
  }

  document.addEventListener("input", function(e) {
    if (e.target.classList.contains("unit") || e.target.classList.contains("qty")) {
      recalcDaily();
    }
  });

  document.getElementById("btnToday").addEventListener("click", () => {
    const today = new Date();
    const y = today.getFullYear();
    const m = String(today.getMonth()+1).padStart(2,"0");
    const d = String(today.getDate()).padStart(2,"0");
    document.getElementById("dDate").value = `${y}-${m}-${d}`;
  });

  // 日報保存
  document.getElementById("btnSave").addEventListener("click", () => {
    const date = document.getElementById("dDate").value;
    if (!date) { alert("日付を入力してください。"); return; }
    const records = loadAllRecords();
    const item = {};
    itemKeys.forEach(key => {
      const unit = parseFloat(document.querySelector('.unit[data-key="'+key+'"]').value) || 0;
      const qty  = parseFloat(document.querySelector('.qty[data-key="'+key+'"]').value) || 0;
      item[key] = { unit, qty };
    });
    const memo = document.getElementById("dMemo").value || "";
    const area = document.getElementById("dArea").value || "";
    const name = document.getElementById("dName").value || "";
    const client = document.getElementById("dClient").value || "";

    let dayTotal = 0;
    let totalQty = 0;
    itemKeys.forEach(k => {
      const u = item[k].unit || 0;
      const q = item[k].qty || 0;
      dayTotal += u*q;
      totalQty += q;
    });

    records[date] = { date, area, name, client, item, memo, totals: { totalQty, dayTotal } };
    saveAllRecords(records);
    recalcDaily();
    alert("保存しました（" + date + "）。");
  });

  // 日報読み込み
  document.getElementById("btnLoad").addEventListener("click", () => {
    const date = document.getElementById("dDate").value;
    if (!date) { alert("日付を入力してください。"); return; }
    const records = loadAllRecords();
    if (!records[date]) { alert("この日のデータはありません。"); return; }
    const r = records[date];
    document.getElementById("dArea").value = r.area || "";
    document.getElementById("dName").value = r.name || "";
    document.getElementById("dClient").value = r.client || "";
    itemKeys.forEach(key => {
      const obj = (r.item && r.item[key]) ? r.item[key] : {unit:"",qty:""};
      document.querySelector('.unit[data-key="'+key+'"]').value = (obj.unit ?? "");
      document.querySelector('.qty[data-key="'+key+'"]').value = (obj.qty ?? "");
    });
    document.getElementById("dMemo").value = r.memo || "";
    recalcDaily();
    alert("読み込みました（" + date + "）。");
  });

  // 日報削除
  document.getElementById("btnClearDay").addEventListener("click", () => {
    const date = document.getElementById("dDate").value;
    if (!date) { alert("日付を入力してください。"); return; }
    const records = loadAllRecords();
    if (!records[date]) { alert("この日のデータはありません。"); return; }
    if (!confirm(date + " のデータを削除しますか？")) return;
    delete records[date];
    saveAllRecords(records);
    alert("削除しました。");
  });

  // 単価設定 読み込み
  document.getElementById("btnUnitLoad").addEventListener("click", () => {
    const client = document.getElementById("uClient").value;
    if (!client) { alert("取引先を選択してください。"); return; }
    const settings = loadUnitSettings();
    const unitSet = settings[client] || {};
    document.querySelectorAll(".u-unit").forEach(input => {
      const key = input.dataset.key;
      input.value = unitSet[key] != null ? unitSet[key] : "";
    });
    alert("単価設定を読み込みました。");
  });

  // 単価設定 保存
  document.getElementById("btnUnitSave").addEventListener("click", () => {
    const client = document.getElementById("uClient").value;
    if (!client) { alert("取引先を選択してください。"); return; }
    const settings = loadUnitSettings();
    const unitSet = {};
    document.querySelectorAll(".u-unit").forEach(input => {
      const key = input.dataset.key;
      const v = parseFloat(input.value);
      if (!isNaN(v)) unitSet[key] = v;
    });
    settings[client] = unitSet;
    saveUnitSettings(settings);
    alert("単価を保存しました（" + client + "）。");
  });

  // 日報側で単価読込
  document.getElementById("btnLoadUnitsFromSetting").addEventListener("click", () => {
    const client = document.getElementById("dClient").value;
    if (!client) { alert("取引先を選択してください。"); return; }
    const settings = loadUnitSettings();
    const unitSet = settings[client];
    if (!unitSet) { alert("この取引先の単価設定がありません。単価設定タブで登録してください。"); return; }
    itemKeys.forEach(key => {
      const unitEl = document.querySelector('.unit[data-key="'+key+'"]');
      if (unitEl) unitEl.value = unitSet[key] != null ? unitSet[key] : "";
    });
    recalcDaily();
    alert("単価を読み込みました（" + client + "）。");
  });

  // 月次実績
  function buildMonthlyTable(monthStr) {
    const container = document.getElementById("monthlyResult");
    container.innerHTML = "";
    if (!monthStr) {
      container.textContent = "表示月を選択してください。";
      return;
    }
    const [y,m] = monthStr.split("-").map(s => parseInt(s,10));
    if (!y || !m) {
      container.textContent = "表示月を正しく選択してください。";
      return;
    }
    const records = loadAllRecords();
    const rows = Object.values(records)
      .filter(r => {
        const info = ymdFromDateStr(r.date);
        return info && info.y === y && info.m === m;
      })
      .sort((a,b) => a.date.localeCompare(b.date));
    if (rows.length === 0) {
      container.textContent = "この月のデータはありません。";
      return;
    }

    const total = { dayTotal: 0 };
    const qtyByKey = {};
    itemKeys.forEach(k => qtyByKey[k] = 0);

    let html = '<table><thead><tr>' +
      '<th>日</th><th>曜</th><th>取引先</th>';
    itemKeys.forEach(k => {
      html += '<th>'+k+' 数量</th>';
    });
    html += '<th>日合計（円）</th></tr></thead><tbody>';

    rows.forEach(r => {
      const info = ymdFromDateStr(r.date);
      const d = info.d;
      const youbi = getYoubi(r.date);
      const item = r.item || {};
      let dayAmount = 0;
      html += '<tr>';
      html += '<td style="text-align:left;">'+d+'</td>';
      html += '<td>'+youbi+'</td>';
      html += '<td style="text-align:left;">'+(r.client || '')+'</td>';
      itemKeys.forEach(k => {
        const u = (item[k] && item[k].unit) ? item[k].unit : 0;
        const q = (item[k] && item[k].qty) ? item[k].qty : 0;
        const sub = u*q;
        html += '<td>'+formatNumber(q)+'</td>';
        dayAmount += sub;
        qtyByKey[k] += q;
      });
      total.dayTotal += dayAmount;
      html += '<td>'+formatNumber(dayAmount)+'</td>';
      html += '</tr>';
    });

    html += '</tbody><tfoot><tr>';
    html += '<td colspan="3" style="text-align:left;">合計</td>';
    itemKeys.forEach(k => {
      html += '<td>'+formatNumber(qtyByKey[k])+'</td>';
    });
    html += '<td>'+formatNumber(total.dayTotal)+'</td>';
    html += '</tr></tfoot></table>';

    container.innerHTML = html;
  }

  document.getElementById("btnShowMonth").addEventListener("click", () => {
    const month = document.getElementById("mMonth").value;
    buildMonthlyTable(month);
  });

  document.getElementById("btnExportCsv").addEventListener("click", () => {
    const month = document.getElementById("mMonth").value;
    if (!month) { alert("表示月を選んでください。"); return; }
    const [y,m] = month.split("-").map(s => parseInt(s,10));
    const records = loadAllRecords();
    const rows = Object.values(records)
      .filter(r => {
        const info = ymdFromDateStr(r.date);
        return info && info.y === y && info.m === m;
      })
      .sort((a,b) => a.date.localeCompare(b.date));
    if (rows.length === 0) {
      alert("この月のデータがありません。");
      return;
    }
    let csv = "日,曜日,取引先," + itemKeys.map(k => k+'数量').join(",") + ",日合計(円)\n";
    rows.forEach(r => {
      const info = ymdFromDateStr(r.date);
      const d = info.d;
      const youbi = getYoubi(r.date);
      const item = r.item || {};
      const arr = [d, youbi, (r.client || "")];
      let dayAmount = 0;
      itemKeys.forEach(k => {
        const u = (item[k] && item[k].unit) ? item[k].unit : 0;
        const q = (item[k] && item[k].qty) ? item[k].qty : 0;
        const sub = u*q;
        arr.push(q);
        dayAmount += sub;
      });
      arr.push(dayAmount);
      csv += arr.join(",") + "\n";
    });
    const blob = new Blob([csv], {type:"text/csv"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "ofa_client_item_"+month.replace("-","")+".csv";
    a.click();
    URL.revokeObjectURL(url);
  });

  // データ管理
  document.getElementById("btnBackup").addEventListener("click", () => {
    const records = loadAllRecords();
    document.getElementById("dataArea").value = JSON.stringify(records, null, 2);
    alert("現在のデータをJSONとして表示しました。コピーして保存してください。");
  });

  document.getElementById("btnImport").addEventListener("click", () => {
    const txt = document.getElementById("dataArea").value.trim();
    if (!txt) { alert("JSONを貼り付けてください。"); return; }
    try {
      const obj = JSON.parse(txt);
      if (!confirm("貼り付けたJSONでデータを上書きします。よろしいですか？")) return;
      saveAllRecords(obj);
      alert("復元しました。");
    } catch (e) {
      alert("JSONの形式が正しくありません。");
    }
  });

  document.getElementById("btnAllClear").addEventListener("click", () => {
    if (!confirm("全ての日報データを削除します。よろしいですか？")) return;
    localStorage.removeItem(STORAGE_KEY);
    alert("全データを削除しました。");
  });

  // 初期処理
  (function init() {
    const today = new Date();
    const y = today.getFullYear();
    const m = String(today.getMonth()+1).padStart(2,"0");
    const d = String(today.getDate()).padStart(2,"0");
    document.getElementById("dDate").value = `${y}-${m}-${d}`;
    document.getElementById("mMonth").value = `${y}-${m}`;
    recalcDaily();
  })();
</script>
</body>
</html>
