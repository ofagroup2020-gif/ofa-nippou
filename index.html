<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>OFA 点呼 / 日報（端末保存・PDF/CSV）</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --card:#ffffff;
      --shadow:0 10px 28px rgba(17,24,39,.08);

      --g1:#20d3c2;
      --g2:#4a90ff;
      --g3:#9b5cff;
      --g4:#ff4d8d;

      --btnText:#ffffff;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP","Helvetica Neue",Arial,sans-serif;
      background: var(--bg);
      color:var(--text);
    }
    header{
      position:sticky;top:0;z-index:10;
      background:#fff;
      border-bottom:1px solid var(--line);
      padding:14px 14px;
      display:flex;align-items:center;gap:12px;
    }
    header img{
      width:110px;height:auto;display:block;
    }
    header .ttl{
      line-height:1.2;
    }
    header .ttl .h1{
      font-weight:900;font-size:15px;
    }
    header .ttl .sub{
      font-size:12px;color:var(--muted);margin-top:3px;
    }

    .wrap{max-width:760px;margin:0 auto;padding:14px 14px 80px;}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      margin:14px 0;
    }
    .h2{
      margin:0 0 10px;
      font-size:15px;
      font-weight:900;
      border-left:6px solid var(--g1);
      padding-left:10px;
    }
    .note{
      font-size:12.5px;
      color:var(--muted);
      line-height:1.55;
      margin:0 0 10px;
    }

    label{
      display:block;
      font-weight:800;
      margin-top:12px;
      font-size:13px;
    }
    .req{color:#ef4444;font-weight:900;margin-left:4px}
    input,select,textarea{
      width:100%;
      padding:12px 12px;
      margin-top:6px;
      border:1px solid #d1d5db;
      border-radius:12px;
      font-size:16px;
      background:#fff;
      color:var(--text);
      outline:none;
    }
    textarea{min-height:90px;resize:vertical}
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media(max-width:640px){
      .row{grid-template-columns:1fr}
    }

    .btn{
      margin-top:14px;
      width:100%;
      border:none;
      border-radius:14px;
      padding:14px 14px;
      font-size:16px;
      font-weight:900;
      color:var(--btnText);
      cursor:pointer;
      background: linear-gradient(90deg,var(--g1),var(--g2),var(--g3),var(--g4));
    }
    .btn.secondary{
      background:#f3f4f6;
      color:#111;
      border:1px solid #e5e7eb;
    }
    .btn.small{
      padding:12px 12px;
      font-size:14px;
    }
    .divider{height:1px;background:var(--line);margin:18px 0;}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background:#f3f4f6;
      border:1px solid #e5e7eb;
      font-size:12px;
      color:#111;
      font-weight:800;
    }
    .grid3{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
    }
    @media(max-width:820px){
      .grid3{grid-template-columns:1fr}
    }

    .checklist{
      max-height:260px;
      overflow-y:auto;
      border:1px solid #d1d5db;
      border-radius:12px;
      padding:10px 10px;
      margin-top:6px;
      background:#fff;
    }
    .checklist .item{
      display:flex;align-items:center;gap:10px;
      padding:7px 6px;
      border-bottom:1px dashed #eee;
      font-size:14px;
    }
    .checklist .item:last-child{border-bottom:none}
    .checklist input[type="checkbox"]{
      width:18px;height:18px;margin:0;
    }

    .miniActions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media(max-width:640px){
      .miniActions{grid-template-columns:1fr}
    }

    .footlink{
      display:block;
      text-decoration:none;
      margin-top:10px;
    }
  </style>
</head>

<body>
<header>
  <img src="https://ofagroup2020-gif.github.io/logo.png" alt="OFA" />
  <div class="ttl">
    <div class="h1">OFA 点呼 / 日報（端末保存・PDF/CSV）</div>
    <div class="sub">IndexedDB保存（1000件超対応） / PDFはOFAフォーマット / CSV日本語出力</div>
  </div>
</header>

<div class="wrap">

  <!-- ① 基本情報 -->
  <div class="card">
    <div class="h2">① 基本情報（必須）</div>
    <p class="note">
      一度保存すれば次回から自動反映します（端末内保存）。<br>
      ※免許証写真・アルコール写真はアップロードしません（PDF生成時のみ使用）。
    </p>

    <label>氏名（本名）<span class="req">*</span></label>
    <input id="p_name" placeholder="例：森下 洸" />

    <label>拠点（47都道府県 / 自由記入）<span class="req">*</span></label>
    <input id="p_base" placeholder="例：鹿児島県 / 東京都 / 福岡" />

    <label>車両番号（ナンバー）</label>
    <input id="p_car" placeholder="例：鹿児島 480 れ 21-15" />

    <label>運転免許証番号<span class="req">*</span></label>
    <input id="p_license" placeholder="例：第1234567890号" />

    <div class="row">
      <div>
        <label>電話番号<span class="req">*</span></label>
        <input id="p_phone" placeholder="080..." />
      </div>
      <div>
        <label>メールアドレス<span class="req">*</span></label>
        <input id="p_email" placeholder="example@ofa.jp" />
      </div>
    </div>

    <label>運転免許証写真（任意：PDFに埋め込み）</label>
    <input type="file" id="f_license" accept="image/*" />
    <p class="note">※保存はしません。PDF作成時だけ使用します。</p>

    <button class="btn" onclick="saveProfile()">基本情報を保存</button>
  </div>

  <!-- ② 点呼（出発/帰着） -->
  <div class="card">
    <div class="h2">② 点呼（出発 / 帰着）</div>
    <p class="note">
      出発時は「出発ODOのみ」入力、帰着時は「帰着ODOのみ」入力。<br>
      走行距離は <b>出発＋帰着が揃った時だけ</b> 自動で差分計算します。
    </p>

    <label>点呼日時（手入力）<span class="req">*</span></label>
    <input type="datetime-local" id="t_at" />

    <label>点呼方法<span class="req">*</span></label>
    <select id="t_method">
      <option value="">選択</option>
      <option>対面</option>
      <option>電話</option>
      <option>アプリ</option>
      <option>その他</option>
    </select>

    <div class="row">
      <div>
        <label>睡眠時間（h）<span class="req">*</span></label>
        <input id="t_sleep" inputmode="decimal" placeholder="例：6.0" />
      </div>
      <div>
        <label>体温（℃）<span class="req">*</span></label>
        <input id="t_temp" inputmode="decimal" placeholder="例：36.6" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>体調<span class="req">*</span></label>
        <select id="t_condition">
          <option value="">選択</option>
          <option>良好</option>
          <option>注意</option>
          <option>不良</option>
        </select>
      </div>
      <div>
        <label>疲労<span class="req">*</span></label>
        <select id="t_fatigue">
          <option value="">選択</option>
          <option>なし</option>
          <option>少し</option>
          <option>強い</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>服薬（体調影響）<span class="req">*</span></label>
        <select id="t_med">
          <option value="">選択</option>
          <option>なし</option>
          <option>あり</option>
        </select>
      </div>
      <div>
        <label>服薬内容（ありの場合）</label>
        <input id="t_med_detail" placeholder="例：風邪薬、眠気あり など" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>アルコール数値<span class="req">*</span></label>
        <input id="t_alc" inputmode="decimal" placeholder="例：0.00" />
      </div>
      <div>
        <label>酒気帯び判定<span class="req">*</span></label>
        <select id="t_alc_judge">
          <option value="">選択</option>
          <option>なし</option>
          <option>疑い</option>
          <option>あり</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>アルコール写真（出発：任意）</label>
        <input type="file" id="f_alc_dep" accept="image/*" />
      </div>
      <div>
        <label>アルコール写真（帰着：任意）</label>
        <input type="file" id="f_alc_arr" accept="image/*" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>出発ODO（出発点呼のみ入力）</label>
        <input id="t_odo_start" inputmode="numeric" placeholder="例：12345" />
      </div>
      <div>
        <label>帰着ODO（帰着点呼のみ入力）</label>
        <input id="t_odo_end" inputmode="numeric" placeholder="例：12500" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>異常の有無<span class="req">*</span></label>
        <select id="t_abn">
          <option value="">選択</option>
          <option>なし</option>
          <option>あり</option>
        </select>
      </div>
      <div>
        <label>異常内容（ありの場合は必須）</label>
        <input id="t_abn_detail" placeholder="例：体調不良 / 車両異音 など" />
      </div>
    </div>

    <div class="divider"></div>

    <!-- ③ 日常点検 -->
    <div class="h2">③ 日常点検（スクロール入力）</div>
    <p class="note">
      チェックは「OKならON」で運用（NGは未チェック + メモに詳細推奨）。<br>
      ※NGがある場合はメモに必ず詳細を書く運用にしてください。
    </p>

    <div class="checklist" id="checklistBox">
      <!-- ここは「OKならチェック」で運用 -->
      <div class="item"><input class="chkItem" type="checkbox" data-label="タイヤ空気圧" /> タイヤ空気圧</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="タイヤ溝/ひび割れ" /> タイヤ溝 / ひび割れ</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ホイールナット緩み" /> ホイールナット緩み</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ブレーキ効き" /> ブレーキ効き</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="パーキングブレーキ" /> パーキングブレーキ</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ハンドル操作" /> ハンドル操作</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ライト（前照灯/尾灯/ブレーキ/ウインカー/ハザード）" /> ライト（前照灯/尾灯/ブレーキ/ウインカー/ハザード）</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ワイパー/ウォッシャー液" /> ワイパー / ウォッシャー液</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ミラー/ガラス破損" /> ミラー / ガラス破損</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="エンジンオイル量" /> エンジンオイル量</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="冷却水" /> 冷却水</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="バッテリー（警告灯含む）" /> バッテリー（警告灯含む）</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="異音/異臭/異常振動" /> 異音 / 異臭 / 異常振動</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="漏れ（オイル/冷却水）" /> 漏れ（オイル / 冷却水）</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="外装破損" /> 外装破損</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="積載状態（偏り/過積載なし）" /> 積載状態（偏り / 過積載なし）</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="消火器" /> 消火器</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="三角停止板" /> 三角停止板</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="反射ベスト" /> 反射ベスト</div>
      <div class="item"><input class="chkItem" type="checkbox" data-label="ジャッキ/工具" /> ジャッキ / 工具</div>
    </div>

    <label>日常点検メモ（NGがある場合は必須）</label>
    <textarea id="t_check_memo" placeholder="例：タイヤ溝が浅い、ブレーキ異音など"></textarea>

    <div class="miniActions">
      <button class="btn small" onclick="saveTenko('departure')">出発点呼を保存</button>
      <button class="btn small secondary" onclick="saveTenko('arrival')">帰着点呼を保存</button>
    </div>
  </div>

  <!-- ④ 日報（任意） -->
  <div class="card">
    <div class="h2">④ 日報（任意：入力したい人だけ）</div>
    <p class="note">
      日報・売上・報酬系は <b>強制しません</b>。必要な人だけ入力してください。<br>
      月報は管理者側で期間検索し、点呼・日報を集計します。
    </p>

    <label>稼働日（これだけ必須）<span class="req">*</span></label>
    <input type="date" id="d_date" />

    <label>案件（メイン）</label>
    <input id="d_project" placeholder="例：Amazon / ヤマト / スポット" />

    <div class="row">
      <div>
        <label>日当（固定報酬）</label>
        <input id="d_pay" inputmode="numeric" placeholder="例：18000" />
      </div>
      <div>
        <label>インセンティブ</label>
        <input id="d_incentive" inputmode="numeric" placeholder="例：2000" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>燃料</label>
        <input id="d_fuel" inputmode="numeric" placeholder="例：3000" />
      </div>
      <div>
        <label>高速</label>
        <input id="d_highway" inputmode="numeric" placeholder="例：1200" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>駐車</label>
        <input id="d_parking" inputmode="numeric" placeholder="例：500" />
      </div>
      <div>
        <label>その他経費</label>
        <input id="d_other" inputmode="numeric" placeholder="例：400" />
      </div>
    </div>

    <label>日報メモ</label>
    <textarea id="d_memo" placeholder="引継ぎ、注意点、トラブル、改善など"></textarea>

    <button class="btn" onclick="saveDaily()">日報を保存（任意）</button>

    <div class="divider"></div>

    <div class="h2">⑤ 出力（今日のPDF / CSV）</div>
    <p class="note">
      PDFは <b>OFAフォーマット</b>（ロゴ・カラー・表）で作成。<br>
      CSVは <b>日本語の列名</b> で出力します（文字化けしないUTF-8）。
    </p>

    <button class="btn" onclick="generateTodayPdf()">今日のPDF（点呼＋日報）を作成</button>

    <div class="divider"></div>

    <div class="h2">⑥ CSV（期間検索して出力）</div>
    <div class="row">
      <div>
        <label>期間（開始）</label>
        <input type="date" id="s_from" />
      </div>
      <div>
        <label>期間（終了）</label>
        <input type="date" id="s_to" />
      </div>
    </div>
    <div class="row">
      <div>
        <label>拠点（部分一致）</label>
        <input id="s_base" placeholder="例：鹿児島" />
      </div>
      <div>
        <label>氏名（部分一致）</label>
        <input id="s_name" placeholder="例：森下" />
      </div>
    </div>

    <button class="btn secondary" onclick="exportCsvSearchResult({
      from: document.getElementById('s_from').value,
      to: document.getElementById('s_to').value,
      base: document.getElementById('s_base').value,
      name: document.getElementById('s_name').value
    })">CSVワンクリック出力（点呼＋日報）</button>

  </div>

  <!-- 問い合わせ -->
  <div class="card">
    <div class="h2">問い合わせ</div>
    <p class="note">
      パスワード確認や不明点は、OFAメンバー専用LINEへ。
    </p>
    <a class="footlink" href="https://lin.ee/7sO7SCQ">
      <button class="btn secondary">OFAメンバー専用LINEへ問い合わせ</button>
    </a>
  </div>

</div>

<!-- scripts -->
<script src="./js/db.js"></script>
<script src="./js/pdf.js"></script>
<script src="./js/csv.js"></script>
<script src="./js/index.js"></script>
</body>
</html>
