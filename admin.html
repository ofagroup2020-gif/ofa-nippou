<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OFA | 管理者</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">管理者（検索 / PDF / CSV / 月報）</div>
          <div class="subtitle">※このページは管理者ログインのみ</div>
        </div>
      </div>
      <button class="btn ghost" id="backBtn" type="button">戻る</button>
    </div>

    <div class="card">
      <div class="grid grid2">
        <div>
          <label>検索：運転者氏名（空なら全員）</label>
          <input id="name" type="text" placeholder="例：森下 洸" />
        </div>
        <div>
          <label>対象月（YYYY-MM） <span class="req">*</span></label>
          <input id="month" type="month" />
        </div>
      </div>

      <div class="btnrow">
        <button class="btn ghost" id="btnCsvAll" type="button">⬇️ CSV（全員/条件）</button>
        <button class="btn ghost" id="btnMonthPdfAll" type="button">📄 月報PDF（条件）</button>
      </div>

      <div class="titleSm">日報PDF（指定日・個人）</div>
      <div class="grid grid2">
        <input id="day" type="date" />
        <button class="btn dark" id="btnDailyPdf" type="button">📄 日報PDFを開く</button>
      </div>

      <small class="hint">
        ※出力はGAS側で生成し、内容がそのまま反映されます。<br>
        ※写真は日報のみリンク掲載。月報は有無のみ。
      </small>

      <div class="toast" id="toast"></div>
    </div>
  </div>

  <script src="./config.js"></script>
  <script src="./common.js"></script>
  <script>
    requireAdmin();

    const nameEl = document.getElementById('name');
    const monthEl = document.getElementById('month');
    const dayEl = document.getElementById('day');

    document.getElementById('btnCsvAll').onclick = ()=>{
      const m = monthEl.value;
      if(!m) return showToast('対象月が未入力です');
      const name = (nameEl.value||'').trim();
      openGAS(`?action=adminCsv&month=${encodeURIComponent(m)}&name=${encodeURIComponent(name)}`);
    };

    document.getElementById('btnMonthPdfAll').onclick = ()=>{
      const m = monthEl.value;
      if(!m) return showToast('対象月が未入力です');
      const name = (nameEl.value||'').trim();
      openGAS(`?action=adminMonthPdf&month=${encodeURIComponent(m)}&name=${encodeURIComponent(name)}`);
    };

    document.getElementById('btnDailyPdf').onclick = ()=>{
      const day = dayEl.value;
      const name = (nameEl.value||'').trim();
      if(!name) return showToast('氏名が未入力です');
      if(!day) return showToast('日付が未入力です');
      openGAS(`?action=dailyPdf&name=${encodeURIComponent(name)}&day=${encodeURIComponent(day)}`);
    };

    document.getElementById('backBtn').onclick = ()=>location.href='./home.html';

    function openGAS(qs){
      window.open(GAS_WEBAPP_URL + qs, '_blank', 'noopener');
    }
  </script>
</body>
</html>
