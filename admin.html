<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>管理者 出力/検索 | OFA</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="config.js"></script>
  <script defer src="app.js"></script>
  <script defer src="auth.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">OFA</div>
      <div class="title">
        <h1>管理者：出力/検索</h1>
        <p>v<span data-version></span></p>
      </div>
    </div>

    <div class="card rainbow-border">
      <div class="topbar">
        <span class="badge" data-login-badge>未ログイン</span>
        <div class="right">
          <a class="badge" href="index.html">メニューへ</a>
        </div>
      </div>

      <div class="section-title">検索</div>
      <div class="row">
        <div class="col">
          <label>期間From</label>
          <input id="from" type="date" />
        </div>
        <div class="col">
          <label>期間To</label>
          <input id="to" type="date" />
        </div>
      </div>
      <label>キーワード（氏名/案件/エリア）</label>
      <input id="kw" placeholder="例：森下 / Amazon / 姶良" />
      <button class="btn btn-dark" id="btn" type="button">検索</button>

      <div class="hr"></div>
      <div id="out"></div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
  OFA_APP.setVersion();
  OFA_AUTH.requireRole("admin");
  OFA_AUTH.setLoginBadge();

  document.getElementById("btn").addEventListener("click", async ()=>{
    try{
      const from = document.getElementById("from").value || "2000-01-01";
      const to   = document.getElementById("to").value || "2100-01-01";
      const kw   = document.getElementById("kw").value || "";
      const r = await OFA_APP.adminSearch(from, to, kw);
      const out = document.getElementById("out");
      if(!r.items || r.items.length===0){
        out.innerHTML = "<div class='mini'>該当なし</div>";
        return;
      }
      out.innerHTML = `
        <table class="table">
          <thead><tr><th>日付</th><th>氏名</th><th>種別</th><th>案件</th><th>エリア</th><th>Drive</th></tr></thead>
          <tbody>
            ${r.items.map(x=>`
              <tr>
                <td>${x.date}</td>
                <td>${x.driverName}</td>
                <td>${x.type}</td>
                <td>${x.project||""}</td>
                <td>${x.area||""}</td>
                <td>${x.driveUrl?`<a target="_blank" rel="noopener" href="${x.driveUrl}">開く</a>`:""}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }catch(e){
      OFA_APP.toast("失敗：" + (e.message||e));
    }
  });
});
</script>
</body>
</html>
