<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>OFA GROUP Webç‚¹å‘¼ãƒ»æ—¥å ±ãƒ•ã‚©ãƒ¼ãƒ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --ofa-green: #38c172;
      --ofa-green-dark: #2f9c5a;
      --ofa-red: #e74c3c;
      --ofa-blue: #3498db;
      --ofa-yellow: #f1c40f;
      --bg-page: #eafaf0;
      --bg-card: #ffffff;
      --text-main: #2c3e50;
      --border-light: #e0e0e0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      line-height: 1.6;
    }

    .container {
      max-width: 720px;
      margin: 24px auto;
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, var(--ofa-green), var(--ofa-green-dark));
      color: #fff;
      padding: 20px 16px 16px;
      text-align: center;
    }

    .header-top {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      font-weight: 700;
    }

    .header-logo-circle {
      background: #fff;
      color: var(--ofa-green);
      font-weight: 900;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 18px;
    }

    .header-title {
      font-size: 20px;
      font-weight: 700;
      margin: 4px 0;
    }

    .header-sub {
      font-size: 12px;
      opacity: 0.9;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-light);
      background: #f8fafb;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 4px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
      color: #666;
      border-bottom: 3px solid transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
    }

    .tab-btn span.icon {
      font-size: 15px;
    }

    .tab-btn.active {
      color: var(--ofa-green-dark);
      border-bottom-color: var(--ofa-green-dark);
      background: #ffffff;
    }

    .content {
      padding: 16px 16px 24px;
    }

    .section-title {
      margin: 18px 0 8px;
      padding: 6px 10px;
      font-size: 14px;
      font-weight: 700;
      background: #f6fbff;
      border-left: 4px solid var(--ofa-yellow);
      color: var(--ofa-blue);
      border-radius: 4px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-size: 13px;
      font-weight: 700;
    }

    .required-mark {
      color: var(--ofa-red);
      margin-left: 3px;
    }

    input[type="text"],
    input[type="tel"],
    input[type="email"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid var(--border-light);
      font-size: 14px;
      background: #fcfffd;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .radio-row {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .radio-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-light);
      background: #fff;
      font-size: 13px;
    }

    .file-note {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }

    .btn-primary {
      width: 100%;
      margin-top: 22px;
      padding: 12px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      background: var(--ofa-red);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 3px 0 #a93226;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 #a93226;
    }

    .message {
      margin-top: 14px;
      padding: 8px 10px;
      font-size: 13px;
      border-radius: 6px;
      display: none;
    }

    .message.success {
      display: block;
      background: #e6ffed;
      color: #1e7e34;
      border: 1px solid #c3f0d0;
    }

    .message.error {
      display: block;
      background: #ffe6e6;
      color: #c0392b;
      border: 1px solid #f5b7b1;
    }

    /* history */
    .history-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .history-info {
      font-size: 12px;
      color: #666;
    }

    .btn-danger-sm {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 999px;
      border: none;
      background: #ff6b6b;
      color: #fff;
      cursor: pointer;
    }

    .history-list {
      margin-top: 6px;
    }

    .history-item {
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 10px 10px;
      margin-top: 8px;
      background: #fff;
      cursor: pointer;
      transition: background 0.15s;
      border-left: 4px solid var(--ofa-blue);
    }

    .history-item:hover {
      background: #f6fbff;
    }

    .history-item-title {
      font-size: 14px;
      font-weight: 700;
    }

    .history-item-sub {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }

    .detail-wrapper {
      margin-top: 10px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      padding: 10px 10px 14px;
      background: #ffffff;
      display: none;
    }

    .detail-header {
      text-align: center;
      border-bottom: 2px solid var(--ofa-green);
      padding-bottom: 6px;
      margin-bottom: 8px;
    }

    .detail-header-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--ofa-blue);
    }

    .detail-header-sub {
      font-size: 12px;
      color: #666;
    }

    .detail-grid {
      font-size: 13px;
    }

    .detail-row {
      display: flex;
      padding: 3px 0;
      border-bottom: 1px dotted #ddd;
    }

    .detail-label {
      width: 36%;
      font-weight: 700;
    }

    .detail-value {
      width: 64%;
    }

    .detail-section-label {
      margin-top: 8px;
      font-size: 13px;
      font-weight: 700;
      color: var(--ofa-green-dark);
    }

    .detail-image {
      margin-top: 4px;
      max-width: 100%;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .detail-buttons {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .btn-outline {
      width: 100%;
      padding: 8px;
      border-radius: 999px;
      border: 1px solid #999;
      background: #fff;
      font-size: 13px;
      cursor: pointer;
    }

    .btn-blue {
      border-color: var(--ofa-blue);
      color: #fff;
      background: var(--ofa-blue);
    }

    /* print */
    @media print {
      body {
        background: #fff;
      }
      .container {
        box-shadow: none;
        border-radius: 0;
        margin: 0;
      }
      .tabs,
      .content > :not(#printArea) {
        display: none !important;
      }
      #printArea {
        display: block !important;
      }
      .detail-buttons {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-top">
        <div class="header-logo-circle">OFA</div>
        <div>OFA GROUP</div>
      </div>
      <div class="header-title">Webç‚¹å‘¼ãƒ»æ—¥å ±ãƒ•ã‚©ãƒ¼ãƒ </div>
      <div class="header-sub">ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¸€æ™‚ä¿å­˜ &nbsp;/&nbsp; PDFã¯å„è‡ªã§ä¿å­˜ãƒ»å…±æœ‰ã—ã¦ãã ã•ã„</div>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="form">
        <span class="icon">ğŸ“</span> ç‚¹å‘¼ãƒ»æ—¥å ±å…¥åŠ›
      </button>
      <button class="tab-btn" data-tab="history">
        <span class="icon">ğŸ“‹</span> å±¥æ­´ãƒ»PDF
      </button>
    </div>

    <div class="content">
      <!-- ====== å…¥åŠ›ã‚¿ãƒ– ====== -->
      <div id="tab-form">
        <form id="tenkoForm" autocomplete="off">
          <div class="section-title">0. ãƒ¢ãƒ¼ãƒ‰é¸æŠ</div>
          <label>ç‚¹å‘¼ãƒ¢ãƒ¼ãƒ‰<span class="required-mark">*</span></label>
          <div class="radio-row">
            <label class="radio-pill">
              <input type="radio" name="mode" value="departure" required /> å‡ºç™ºç‚¹å‘¼
            </label>
            <label class="radio-pill">
              <input type="radio" name="mode" value="return" /> å¸°åº«ç‚¹å‘¼ï¼ˆæ—¥å ±ï¼‰
            </label>
          </div>

          <div class="section-title">1. åŸºæœ¬æƒ…å ±</div>

          <label for="date">æ—¥ä»˜<span class="required-mark">*</span></label>
          <input type="date" id="date" required />

          <label for="driverName">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼å<span class="required-mark">*</span></label>
          <input type="text" id="driverName" required />

          <label for="company">æ‰€å±ä¼šç¤¾<span class="required-mark">*</span></label>
          <input type="text" id="company" required />

          <label for="phone">é›»è©±ç•ªå·</label>
          <input type="tel" id="phone" placeholder="ä¾‹: 08012345678" />

          <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input type="email" id="email" placeholder="ä¾‹: example@ofa-group.jp" />

          <label for="client">æ¡ˆä»¶ï¼ˆè·ä¸»ï¼‰</label>
          <input type="text" id="client" placeholder="ä¾‹: Amazon / ãƒ¤ãƒãƒˆé‹è¼¸ãªã©" />

          <label for="area">ã‚¨ãƒªã‚¢</label>
          <input type="text" id="area" placeholder="ä¾‹: é¹¿å…å³¶å¸‚å—æ „" />

          <label for="licensePhoto">é‹è»¢å…è¨±è¨¼ å†™çœŸï¼ˆä»»æ„ï¼‰</label>
          <input type="file" id="licensePhoto" accept="image/*" />
          <div class="file-note">â€» æ›´æ–°ã‚„å¤‰æ›´æ™‚ã®ã¿ã§OKï¼ˆPDFã«ç¸®å°è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>

          <!-- ====== å‡ºç™ºç‚¹å‘¼ ====== -->
          <div id="section-departure">
            <div class="section-title">2. å‡ºç™ºå‰ãƒã‚§ãƒƒã‚¯</div>

            <label for="startPlace">å‡ºåº«å ´æ‰€<span class="required-mark">*</span></label>
            <input type="text" id="startPlace" placeholder="ä¾‹: Amazonå—æ „ãƒ‡ãƒ" />

            <label for="workTime">å‡ºå‹¤æ™‚é–“</label>
            <input type="time" id="workTime" />

            <label for="startTime">å‡ºç™ºæ™‚é–“<span class="required-mark">*</span></label>
            <input type="time" id="startTime" />

            <label for="condition">ä½“èª¿<span class="required-mark">*</span></label>
            <select id="condition">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="è‰¯å¥½">è‰¯å¥½</option>
              <option value="æ™®é€š">æ™®é€š</option>
              <option value="ä¸èª¿">ä¸èª¿</option>
            </select>

            <label for="sleep">ç¡çœ æ™‚é–“ï¼ˆæ™‚é–“ï¼‰</label>
            <input type="number" id="sleep" step="0.5" placeholder="ä¾‹: 6.5" />

            <label>é£²é…’ï¼ˆ24hä»¥å†…ï¼‰<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="drink" value="ãªã—" /> ãªã—
              </label>
              <label class="radio-pill">
                <input type="radio" name="drink" value="ã‚ã‚Š" /> ã‚ã‚Š
              </label>
            </div>

            <label>æœè–¬ï¼ˆé‹è»¢ã«å½±éŸ¿ã™ã‚‹è–¬ï¼‰</label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="medicine" value="ãªã—" /> ãªã—
              </label>
              <label class="radio-pill">
                <input type="radio" name="medicine" value="ã‚ã‚Š" /> ã‚ã‚Š
              </label>
            </div>

            <label for="temp">ä½“æ¸©ï¼ˆâ„ƒï¼‰<span class="required-mark">*</span></label>
            <input type="number" id="temp" step="0.1" placeholder="ä¾‹: 36.5" />

            <label for="alcoholValue">ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ¤œæŸ»å€¤ï¼ˆmg/Lï¼‰<span class="required-mark">*</span></label>
            <input type="text" id="alcoholValue" placeholder="ä¾‹: 0.00" />

            <label for="startMeter">å‡ºç™ºå‰ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆkmï¼‰<span class="required-mark">*</span></label>
            <input type="number" id="startMeter" />

            <div class="section-title">3. æ—¥å¸¸ç‚¹æ¤œ</div>

            <label>ãƒ–ãƒ¬ãƒ¼ã‚­<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="check_brake" value="OK" /> OK
              </label>
              <label class="radio-pill">
                <input type="radio" name="check_brake" value="ç•°å¸¸ã‚ã‚Š" /> ç•°å¸¸ã‚ã‚Š
              </label>
            </div>

            <label>ã‚¿ã‚¤ãƒ¤<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="check_tire" value="OK" /> OK
              </label>
              <label class="radio-pill">
                <input type="radio" name="check_tire" value="ç•°å¸¸ã‚ã‚Š" /> ç•°å¸¸ã‚ã‚Š
              </label>
            </div>

            <label>ç¯ç«é¡<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="check_light" value="OK" /> OK
              </label>
              <label class="radio-pill">
                <input type="radio" name="check_light" value="ç•°å¸¸ã‚ã‚Š" /> ç•°å¸¸ã‚ã‚Š
              </label>
            </div>

            <label>ã‚«ãƒ¡ãƒ©ãƒ»ãƒŸãƒ©ãƒ¼<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="check_camera" value="OK" /> OK
              </label>
              <label class="radio-pill">
                <input type="radio" name="check_camera" value="ç•°å¸¸ã‚ã‚Š" /> ç•°å¸¸ã‚ã‚Š
              </label>
            </div>

            <label>è»Šä½“å¤–è¦³<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="check_body" value="OK" /> OK
              </label>
              <label class="radio-pill">
                <input type="radio" name="check_body" value="ç•°å¸¸ã‚ã‚Š" /> ç•°å¸¸ã‚ã‚Š
              </label>
            </div>

            <label>ãã®ä»–ç‚¹æ¤œ<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="check_other" value="OK" /> OK
              </label>
              <label class="radio-pill">
                <input type="radio" name="check_other" value="ç•°å¸¸ã‚ã‚Š" /> ç•°å¸¸ã‚ã‚Š
              </label>
            </div>

            <label for="checkNote">ç‚¹æ¤œãƒ¡ãƒ¢</label>
            <textarea id="checkNote" placeholder="æ°—ã«ãªã£ãŸç‚¹ãªã©"></textarea>

            <label for="checkAbnormalPhoto">æ—¥å¸¸ç‚¹æ¤œã®ç•°å¸¸å†™çœŸï¼ˆä»»æ„ï¼‰</label>
            <input type="file" id="checkAbnormalPhoto" accept="image/*" />
            <div class="file-note">â€» ç•°å¸¸ãŒã‚ã£ãŸç®‡æ‰€ã®å†™çœŸã‚’1æšã¾ã§æ·»ä»˜ã§ãã¾ã™</div>
          </div>

          <!-- ====== å¸°åº«ç‚¹å‘¼ ====== -->
          <div id="section-return">
            <div class="section-title">2. å¸°åº«ãƒ»é‹è¡Œè¨˜éŒ²</div>

            <label for="returnPlace">å¸°åº«å ´æ‰€<span class="required-mark">*</span></label>
            <input type="text" id="returnPlace" placeholder="ä¾‹: Amazonå—æ „ãƒ‡ãƒ" />

            <label for="returnTime">å¸°åº«æ™‚é–“<span class="required-mark">*</span></label>
            <input type="time" id="returnTime" />

            <label for="returnStartMeter">å‡ºç™ºãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆä»»æ„ï¼‰</label>
            <input type="number" id="returnStartMeter" placeholder="è¦šãˆã¦ã„ã‚Œã°å…¥åŠ›" />

            <label for="returnMeter">å¸°åº«ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆkmï¼‰<span class="required-mark">*</span></label>
            <input type="number" id="returnMeter" />

            <label for="distance">ç·èµ°è¡Œè·é›¢ï¼ˆkmãƒ»è‡ªå‹•è¨ˆç®—ï¼‰</label>
            <input type="number" id="distance" readonly />

            <label for="rest">ä¼‘æ†©æ™‚é–“ãƒ»å ´æ‰€</label>
            <input type="text" id="rest" placeholder="ä¾‹: 1æ™‚é–“30åˆ† / SAã§ä¼‘æ†©" />

            <label>ä»£é‡‘å…¥é‡‘çŠ¶æ³ï¼ˆç€æ‰•ã„ãƒ»ç«‹æ›¿ï¼‰<span class="required-mark">*</span></label>
            <div class="radio-row">
              <label class="radio-pill">
                <input type="radio" name="codStatus" value="ãªã—" /> ãªã—
              </label>
              <label class="radio-pill">
                <input type="radio" name="codStatus" value="å…¥é‡‘æ¸ˆ" /> å…¥é‡‘æ¸ˆ
              </label>
              <label class="radio-pill">
                <input type="radio" name="codStatus" value="å¾Œæ—¥å¯¾å¿œ" /> å¾Œæ—¥å¯¾å¿œ
              </label>
            </div>

            <label for="codAmount">ä»£é‡‘å…¥é‡‘é¡ï¼ˆå††ï¼‰</label>
            <input type="number" id="codAmount" />

            <label for="roadStatus">é“è·¯ãƒ»é‹è¡ŒçŠ¶æ³</label>
            <textarea id="roadStatus" placeholder="æ¸‹æ»ãƒ»è¦åˆ¶ãƒ»å¤©å€™ãªã©"></textarea>

            <label for="abnormalDetail">é‹è¡Œä¸­ã®ç•°å¸¸ã®è©³ç´°ï¼ˆã‚ã‚Œã°ï¼‰</label>
            <textarea id="abnormalDetail" placeholder="è»Šä¸¡ãƒ»è·ç‰©ãƒ»äº‹æ•…ãƒ»ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆãªã©"></textarea>

            <label for="runAbnormalPhoto">é‹è¡Œä¸­ã®ç•°å¸¸å†™çœŸï¼ˆä»»æ„ï¼‰</label>
            <input type="file" id="runAbnormalPhoto" accept="image/*" />
            <div class="file-note">â€» äº‹æ•…ã‚„è»Šä¸¡ãƒˆãƒ©ãƒ–ãƒ«ãªã©ãŒã‚ã‚Œã°æ·»ä»˜</div>
          </div>

          <button type="submit" class="btn-primary">ã“ã®è¨˜éŒ²ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜</button>
          <div id="message" class="message"></div>
        </form>
      </div>

      <!-- ====== å±¥æ­´ã‚¿ãƒ– ====== -->
      <div id="tab-history" style="display: none;">
        <div class="section-title" style="margin-top:0;">ä¿å­˜ã•ã‚ŒãŸç‚¹å‘¼å±¥æ­´</div>
        <div class="history-controls">
          <div class="history-info">
            â€» ã“ã®ç«¯æœ«ãƒ»ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ã ã‘ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™
          </div>
          <button id="btnClearAll" class="btn-danger-sm">å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤</button>
        </div>

        <div id="historyList" class="history-list"></div>

        <div id="printArea" class="detail-wrapper"></div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "ofa_group_tenko_records_v2";

    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabForm = document.getElementById("tab-form");
    const tabHistory = document.getElementById("tab-history");

    const form = document.getElementById("tenkoForm");
    const messageBox = document.getElementById("message");

    const dateInput = document.getElementById("date");
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    const sectionDeparture = document.getElementById("section-departure");
    const sectionReturn = document.getElementById("section-return");

    const returnStartMeterInput = document.getElementById("returnStartMeter");
    const returnMeterInput = document.getElementById("returnMeter");
    const distanceInput = document.getElementById("distance");

    const historyList = document.getElementById("historyList");
    const printArea = document.getElementById("printArea");
    const btnClearAll = document.getElementById("btnClearAll");

    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’åˆæœŸã‚»ãƒƒãƒˆ
    dateInput.value = new Date().toISOString().slice(0, 10);

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.getAttribute("data-tab");
        if (tab === "form") {
          tabForm.style.display = "block";
          tabHistory.style.display = "none";
        } else {
          tabForm.style.display = "none";
          tabHistory.style.display = "block";
          renderHistory();
        }
      });
    });

    // ===== ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ =====
    function updateModeUI() {
      const mode = document.querySelector('input[name="mode"]:checked');
      if (!mode) {
        sectionDeparture.style.display = "none";
        sectionReturn.style.display = "none";
        return;
      }

      const isDeparture = mode.value === "departure";
      sectionDeparture.style.display = isDeparture ? "block" : "none";
      sectionReturn.style.display = isDeparture ? "none" : "block";

      // å¿…é ˆé …ç›®ã®åˆ‡ã‚Šæ›¿ãˆ
      const depRequiredSelectors = [
        "#startPlace",
        "#startTime",
        "#condition",
        "#temp",
        "#alcoholValue",
        "#startMeter",
        'input[name="drink"]',
        'input[name="check_brake"]',
        'input[name="check_tire"]',
        'input[name="check_light"]',
        'input[name="check_camera"]',
        'input[name="check_body"]',
        'input[name="check_other"]'
      ];
      const retRequiredSelectors = [
        "#returnPlace",
        "#returnTime",
        "#returnMeter",
        'input[name="codStatus"]'
      ];

      setRequired(depRequiredSelectors, isDeparture);
      setRequired(retRequiredSelectors, !isDeparture);
    }

    function setRequired(selectors, required) {
      selectors.forEach((sel) => {
        document.querySelectorAll(sel).forEach((el) => {
          el.required = required;
        });
      });
    }

    modeRadios.forEach((radio) => {
      radio.addEventListener("change", updateModeUI);
    });

    // åˆæœŸçŠ¶æ…‹ã¯ã©ã¡ã‚‰ã‚‚éè¡¨ç¤º
    updateModeUI();

    // ===== èµ°è¡Œè·é›¢ è‡ªå‹•è¨ˆç®— =====
    function updateDistance() {
      const s = parseFloat(returnStartMeterInput.value);
      const e = parseFloat(returnMeterInput.value);
      if (!isNaN(s) && !isNaN(e) && e >= s) {
        distanceInput.value = (e - s).toFixed(1);
      } else {
        distanceInput.value = "";
      }
    }
    returnStartMeterInput.addEventListener("input", updateDistance);
    returnMeterInput.addEventListener("input", updateDistance);

    // ===== ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«å¤‰æ› =====
    function fileToDataUrl(file) {
      return new Promise((resolve) => {
        if (!file) {
          resolve(null);
          return;
        }
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = () => resolve(null);
        reader.readAsDataURL(file);
      });
    }

    // ===== ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ =====
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!form.reportValidity()) return;

      const mode = document.querySelector('input[name="mode"]:checked')?.value;
      if (!mode) {
        showMessage("å‡ºç™ºç‚¹å‘¼ / å¸°åº«ç‚¹å‘¼ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚", "error");
        return;
      }

      // ç”»åƒã‚’ã¾ã¨ã‚ã¦èª­ã¿è¾¼ã¿
      const licensePhotoFile = document.getElementById("licensePhoto").files[0];
      const checkAbnormalPhotoFile = document.getElementById("checkAbnormalPhoto")
        .files[0];
      const runAbnormalPhotoFile =
        document.getElementById("runAbnormalPhoto").files[0];

      const [licensePhoto, checkAbnormalPhoto, runAbnormalPhoto] =
        await Promise.all([
          fileToDataUrl(licensePhotoFile),
          fileToDataUrl(checkAbnormalPhotoFile),
          fileToDataUrl(runAbnormalPhotoFile)
        ]);

      const base = {
        id: Date.now(),
        mode, // "departure" or "return"
        date: dateInput.value,
        driverName: document.getElementById("driverName").value.trim(),
        company: document.getElementById("company").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        email: document.getElementById("email").value.trim(),
        client: document.getElementById("client").value.trim(),
        area: document.getElementById("area").value.trim(),
        licensePhoto,
        createdAt: new Date().toLocaleString("ja-JP")
      };

      let extra = {};
      if (mode === "departure") {
        extra = {
          startPlace: document.getElementById("startPlace").value.trim(),
          workTime: document.getElementById("workTime").value,
          startTime: document.getElementById("startTime").value,
          condition: document.getElementById("condition").value,
          sleep: document.getElementById("sleep").value,
          drink: getRadioValue("drink"),
          medicine: getRadioValue("medicine"),
          temp: document.getElementById("temp").value,
          alcoholValue: document.getElementById("alcoholValue").value.trim(),
          startMeter: document.getElementById("startMeter").value,
          check_brake: getRadioValue("check_brake"),
          check_tire: getRadioValue("check_tire"),
          check_light: getRadioValue("check_light"),
          check_camera: getRadioValue("check_camera"),
          check_body: getRadioValue("check_body"),
          check_other: getRadioValue("check_other"),
          checkNote: document.getElementById("checkNote").value.trim(),
          checkAbnormalPhoto
        };
      } else {
        extra = {
          returnPlace: document.getElementById("returnPlace").value.trim(),
          returnTime: document.getElementById("returnTime").value,
          returnStartMeter: document.getElementById("returnStartMeter").value,
          returnMeter: document.getElementById("returnMeter").value,
          distance: document.getElementById("distance").value,
          rest: document.getElementById("rest").value.trim(),
          codStatus: getRadioValue("codStatus"),
          codAmount: document.getElementById("codAmount").value,
          roadStatus: document.getElementById("roadStatus").value.trim(),
          abnormalDetail: document.getElementById("abnormalDetail").value.trim(),
          runAbnormalPhoto
        };
      }

      const record = { ...base, ...extra };
      saveRecord(record);
      showMessage(
        `${mode === "departure" ? "å‡ºç™ºç‚¹å‘¼" : "å¸°åº«ç‚¹å‘¼ï¼ˆæ—¥å ±ï¼‰"}ã®è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚`,
        "success"
      );

      form.reset();
      dateInput.value = new Date().toISOString().slice(0, 10);
      updateModeUI();
    });

    function getRadioValue(name) {
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : "";
    }

    function showMessage(text, type) {
      messageBox.textContent = text;
      messageBox.className = "message " + type;
    }

    // ===== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ =====
    function getRecords() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch (e) {
        return [];
      }
    }

    function saveRecord(record) {
      const list = getRecords();
      list.push(record);
      list.sort((a, b) => b.id - a.id);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    // ===== å±¥æ­´è¡¨ç¤º =====
    function renderHistory() {
      const records = getRecords();
      historyList.innerHTML = "";
      printArea.style.display = "none";
      printArea.innerHTML = "";

      if (!records.length) {
        historyList.innerHTML =
          '<p style="font-size:13px; color:#777; text-align:center; padding:12px 0;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
        return;
      }

      records.forEach((rec) => {
        const item = document.createElement("div");
        item.className = "history-item";
        const modeLabel =
          rec.mode === "departure" ? "å‡ºç™ºç‚¹å‘¼" : "å¸°åº«ç‚¹å‘¼ï¼ˆæ—¥å ±ï¼‰";
        item.innerHTML = `
          <div class="history-item-title">${rec.date} / ${modeLabel}</div>
          <div class="history-item-sub">${rec.driverName || "-"} / ${
          rec.company || "-"
        }</div>
        `;
        item.addEventListener("click", () => showRecordDetail(rec));
        historyList.appendChild(item);
      });
    }

    function showRecordDetail(rec) {
      const modeLabel = rec.mode === "departure" ? "å‡ºç™ºç‚¹å‘¼" : "å¸°åº«ç‚¹å‘¼ï¼ˆæ—¥å ±ï¼‰";

      let html = `
        <div class="detail-header">
          <div class="detail-header-title">${rec.date} ${modeLabel}</div>
          <div class="detail-header-sub">${
            rec.driverName || "-"
          } / ${rec.company || "-"} &nbsp; (${rec.createdAt || "-"})</div>
        </div>
        <div class="detail-grid">
          <div class="detail-section-label">â–  åŸºæœ¬æƒ…å ±</div>
          ${detailRow("ãƒ‰ãƒ©ã‚¤ãƒãƒ¼å", rec.driverName)}
          ${detailRow("æ‰€å±ä¼šç¤¾", rec.company)}
          ${detailRow("é›»è©±ç•ªå·", rec.phone)}
          ${detailRow("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", rec.email)}
          ${detailRow("æ¡ˆä»¶ï¼ˆè·ä¸»ï¼‰", rec.client)}
          ${detailRow("ã‚¨ãƒªã‚¢", rec.area)}
      `;

      if (rec.mode === "departure") {
        html += `
          <div class="detail-section-label">â–  å‡ºç™ºå‰ãƒã‚§ãƒƒã‚¯</div>
          ${detailRow("å‡ºåº«å ´æ‰€", rec.startPlace)}
          ${detailRow("å‡ºå‹¤æ™‚é–“", rec.workTime)}
          ${detailRow("å‡ºç™ºæ™‚é–“", rec.startTime)}
          ${detailRow("ä½“èª¿", rec.condition)}
          ${detailRow("ç¡çœ æ™‚é–“ï¼ˆhï¼‰", rec.sleep)}
          ${detailRow("é£²é…’ï¼ˆ24hä»¥å†…ï¼‰", rec.drink)}
          ${detailRow("æœè–¬", rec.medicine)}
          ${detailRow("ä½“æ¸©ï¼ˆâ„ƒï¼‰", rec.temp)}
          ${detailRow("ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«å€¤", rec.alcoholValue)}
          ${detailRow("å‡ºç™ºå‰ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆkmï¼‰", rec.startMeter)}

          <div class="detail-section-label">â–  æ—¥å¸¸ç‚¹æ¤œ</div>
          ${detailRow("ãƒ–ãƒ¬ãƒ¼ã‚­", rec.check_brake)}
          ${detailRow("ã‚¿ã‚¤ãƒ¤", rec.check_tire)}
          ${detailRow("ç¯ç«é¡", rec.check_light)}
          ${detailRow("ã‚«ãƒ¡ãƒ©ãƒ»ãƒŸãƒ©ãƒ¼", rec.check_camera)}
          ${detailRow("è»Šä½“å¤–è¦³", rec.check_body)}
          ${detailRow("ãã®ä»–ç‚¹æ¤œ", rec.check_other)}
          ${detailRow("ç‚¹æ¤œãƒ¡ãƒ¢", rec.checkNote)}
        `;
      } else {
        html += `
          <div class="detail-section-label">â–  å¸°åº«ãƒ»é‹è¡Œè¨˜éŒ²</div>
          ${detailRow("å¸°åº«å ´æ‰€", rec.returnPlace)}
          ${detailRow("å¸°åº«æ™‚é–“", rec.returnTime)}
          ${detailRow("å‡ºç™ºãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆkmï¼‰", rec.returnStartMeter)}
          ${detailRow("å¸°åº«ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆkmï¼‰", rec.returnMeter)}
          ${detailRow("ç·èµ°è¡Œè·é›¢ï¼ˆkmï¼‰", rec.distance)}
          ${detailRow("ä¼‘æ†©æ™‚é–“ãƒ»å ´æ‰€", rec.rest)}
          ${detailRow("ä»£é‡‘å…¥é‡‘çŠ¶æ³", rec.codStatus)}
          ${detailRow("ä»£é‡‘å…¥é‡‘é¡ï¼ˆå††ï¼‰", rec.codAmount)}
          ${detailRow("é“è·¯ãƒ»é‹è¡ŒçŠ¶æ³", rec.roadStatus)}
          ${detailRow("é‹è¡Œä¸­ã®ç•°å¸¸ã®è©³ç´°", rec.abnormalDetail)}
        `;
      }

      // ç”»åƒ
      html += `<div class="detail-section-label">â–  å†™çœŸ</div>`;
      if (rec.licensePhoto) {
        html += `
          <div class="detail-row">
            <div class="detail-label">å…è¨±è¨¼å†™çœŸ</div>
            <div class="detail-value"><img src="${
              rec.licensePhoto
            }" class="detail-image" alt="å…è¨±è¨¼å†™çœŸ" /></div>
          </div>
        `;
      }
      if (rec.checkAbnormalPhoto) {
        html += `
          <div class="detail-row">
            <div class="detail-label">æ—¥å¸¸ç‚¹æ¤œ ç•°å¸¸å†™çœŸ</div>
            <div class="detail-value"><img src="${
              rec.checkAbnormalPhoto
            }" class="detail-image" alt="ç‚¹æ¤œç•°å¸¸å†™çœŸ" /></div>
          </div>
        `;
      }
      if (rec.runAbnormalPhoto) {
        html += `
          <div class="detail-row">
            <div class="detail-label">é‹è¡Œä¸­ã®ç•°å¸¸å†™çœŸ</div>
            <div class="detail-value"><img src="${
              rec.runAbnormalPhoto
            }" class="detail-image" alt="é‹è¡Œç•°å¸¸å†™çœŸ" /></div>
          </div>
        `;
      }

      html += `</div>`;

      html += `
        <div class="detail-buttons">
          <button class="btn-outline btn-blue" onclick="window.print()">ã“ã®ç”»é¢ã‚’PDFã«ã™ã‚‹ï¼ˆå°åˆ·ï¼‰</button>
          <button class="btn-outline" onclick="document.getElementById('printArea').style.display='none';">é–‰ã˜ã‚‹</button>
        </div>
      `;

      printArea.innerHTML = html;
      printArea.style.display = "block";
      printArea.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function detailRow(label, value) {
      return `
        <div class="detail-row">
          <div class="detail-label">${label}</div>
          <div class="detail-value">${value ? String(value) : "-"}</div>
        </div>
      `;
    }

    // å±¥æ­´å…¨å‰Šé™¤
    btnClearAll.addEventListener("click", () => {
      if (!confirm("ã“ã®ç«¯æœ«ã«ä¿å­˜ã•ã‚ŒãŸç‚¹å‘¼å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      localStorage.removeItem(STORAGE_KEY);
      renderHistory();
    });

    // åˆå›å±¥æ­´è¡¨ç¤ºï¼ˆã‚¿ãƒ–é–‹ã„ã¦ã„ãªã„ã¨ãã¯ç©ºã§OKï¼‰
    // renderHistory(); // å¿…è¦ãªã‚‰æœ‰åŠ¹åŒ–
  </script>
</body>
</html>
