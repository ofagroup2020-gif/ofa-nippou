<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>出発点呼 | OFA</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="config.js"></script>
  <script defer src="app.js"></script>
  <script defer src="auth.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">OFA</div>
      <div class="title">
        <h1>出発点呼</h1>
        <p>v<span data-version></span></p>
      </div>
    </div>

    <div class="card rainbow-border">
      <div class="topbar">
        <span class="badge" data-login-badge>未ログイン</span>
        <div class="right">
          <a class="badge" href="index.html">メニューへ</a>
        </div>
      </div>
      <div class="mini">※必須項目は「*」です。送信後はスプレッドシート保存＆写真はDrive保存（リンク保持）</div>
    </div>

    <form id="f" class="card rainbow-border">
      <div class="section-title">基本情報</div>

      <label class="req">氏名</label>
      <input name="driverName" required placeholder="例：森下 洸" />

      <div class="row">
        <div class="col">
          <label class="req">日付</label>
          <input name="date" type="date" required />
        </div>
        <div class="col">
          <label>電話番号</label>
          <input name="phone" inputmode="tel" placeholder="任意" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>案件</label>
          <input name="project" placeholder="例：Amazon" />
        </div>
        <div class="col">
          <label>配送エリア</label>
          <input name="area" placeholder="例：姶良市" />
        </div>
      </div>

      <label class="req">点呼方法</label>
      <select name="method" required>
        <option>対面</option>
        <option>電話</option>
        <option>ビデオ</option>
        <option>その他</option>
      </select>

      <div class="hr"></div>
      <div class="section-title">点呼項目（法令/運用に基づく）</div>

      <div class="row">
        <div class="col">
          <label class="req">睡眠時間（時間）</label>
          <input name="sleepHours" required inputmode="decimal" placeholder="例：6.5" />
        </div>
        <div class="col">
          <label>体温（℃）</label>
          <input name="temperature" inputmode="decimal" placeholder="例：36.6" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="req">体調</label>
          <select name="condition" required>
            <option>良好</option>
            <option>やや不良</option>
            <option>不良</option>
          </select>
        </div>
        <div class="col">
          <label class="req">疲労</label>
          <select name="fatigue" required>
            <option>なし</option>
            <option>少し</option>
            <option>あり</option>
          </select>
        </div>
      </div>

      <label class="req">服薬/体調影響（有無）</label>
      <select name="medication" required>
        <option>なし</option>
        <option>あり</option>
      </select>

      <div class="hr"></div>
      <div class="section-title">アルコール（必須）</div>

      <div class="row">
        <div class="col">
          <label class="req">アルコール数値（mg/L等）</label>
          <input name="alcoholValue" required inputmode="decimal" placeholder="例：0 / 0.00" />
        </div>
        <div class="col">
          <label class="req">酒気帯び判定</label>
          <select name="alcoholJudge" required>
            <option>なし</option>
            <option>あり</option>
            <option>疑い</option>
          </select>
        </div>
      </div>

      <label>アルコールチェック写真（任意）</label>
      <input name="alcoholPhoto" type="file" accept="image/*" />

      <div class="hr"></div>
      <div class="section-title">免許（番号必須 / 写真任意）</div>

      <label class="req">免許証番号</label>
      <input name="licenseNo" required placeholder="番号を入力（必須）" />

      <label>免許写真（任意）</label>
      <input name="licensePhoto" type="file" accept="image/*" />

      <label>点呼写真（任意）</label>
      <input name="tenkoPhoto" type="file" accept="image/*" />

      <div class="hr"></div>
      <div class="section-title">日常点検（車両点検）</div>

      <!-- 点検項目：増量版 -->
      <div class="row">
        <div class="col">
          <label class="req">タイヤ</label>
          <select name="insp_tire" required><option>OK</option><option>NG</option></select>
        </div>
        <div class="col">
          <label class="req">灯火類</label>
          <select name="insp_light" required><option>OK</option><option>NG</option></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="req">ブレーキ</label>
          <select name="insp_brake" required><option>OK</option><option>NG</option></select>
        </div>
        <div class="col">
          <label class="req">ワイパー</label>
          <select name="insp_wiper" required><option>OK</option><option>NG</option></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="req">ホーン</label>
          <select name="insp_horn" required><option>OK</option><option>NG</option></select>
        </div>
        <div class="col">
          <label class="req">ミラー</label>
          <select name="insp_mirror" required><option>OK</option><option>NG</option></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="req">エンジンオイル</label>
          <select name="insp_engineOil" required><option>OK</option><option>NG</option></select>
        </div>
        <div class="col">
          <label class="req">冷却水</label>
          <select name="insp_coolant" required><option>OK</option><option>NG</option></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="req">外装/破損</label>
          <select name="insp_damage" required><option>OK</option><option>NG</option></select>
        </div>
        <div class="col">
          <label class="req">積載状態</label>
          <select name="insp_cargo" required><option>OK</option><option>NG</option></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="req">消火器</label>
          <select name="insp_extinguisher" required><option>OK</option><option>NG</option></select>
        </div>
        <div class="col">
          <label class="req">三角停止板</label>
          <select name="insp_triangle" required><option>OK</option><option>NG</option></select>
        </div>
      </div>

      <label>点検メモ（任意：NGは必ず詳細）</label>
      <textarea name="inspMemo" placeholder="NGの場合は必ず詳細"></textarea>

      <label>異常箇所写真（任意：NG時推奨）</label>
      <input name="abnormalPhoto" type="file" accept="image/*" />

      <div class="hr"></div>
      <button class="btn btn-rainbow" id="btn" type="submit">送信（出発点呼）→ 保存してトップへ</button>
      <div class="mini">※送信後、成功メッセージが出たらOKです。</div>
    </form>
  </div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
  OFA_APP.setVersion();
  OFA_AUTH.requireRole("driver");
  OFA_AUTH.setLoginBadge();

  const f = document.getElementById("f");
  f.date.value = OFA_APP.todayYMD();

  f.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const btn = document.getElementById("btn");
    btn.disabled = true;
    try{
      OFA_APP.toast("送信中…（回線が弱くてもOK）", 1600);
      await OFA_APP.submitForm("departure", f);
      OFA_APP.toast("送信完了：出発点呼を保存しました");
      setTimeout(()=>location.href="index.html", 700);
    }catch(err){
      OFA_APP.toast("送信失敗：" + (err?.message || err));
    }finally{
      btn.disabled = false;
    }
  });
});
</script>
</body>
</html>
